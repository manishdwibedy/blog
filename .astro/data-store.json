[["Map",1,2,9,10],"meta::meta",["Map",3,4,5,6,7,8],"astro-version","5.16.11","content-config-digest","a998afc544f5dd3c","astro-config-digest","{\"root\":{},\"srcDir\":{},\"publicDir\":{},\"outDir\":{},\"cacheDir\":{},\"site\":\"https://blog.manishd.in\",\"compressHTML\":true,\"base\":\"/\",\"trailingSlash\":\"ignore\",\"output\":\"static\",\"scopedStyleStrategy\":\"attribute\",\"build\":{\"format\":\"directory\",\"client\":{},\"server\":{},\"assets\":\"_astro\",\"serverEntry\":\"entry.mjs\",\"redirects\":true,\"inlineStylesheets\":\"auto\",\"concurrency\":1},\"server\":{\"open\":false,\"host\":false,\"port\":4321,\"streaming\":true,\"allowedHosts\":[]},\"redirects\":{},\"image\":{\"endpoint\":{\"route\":\"/_image\"},\"service\":{\"entrypoint\":\"astro/assets/services/sharp\",\"config\":{}},\"domains\":[],\"remotePatterns\":[],\"responsiveStyles\":false},\"devToolbar\":{\"enabled\":true},\"markdown\":{\"syntaxHighlight\":{\"type\":\"shiki\",\"excludeLangs\":[\"math\"]},\"shikiConfig\":{\"langs\":[],\"langAlias\":{},\"theme\":\"github-dark\",\"themes\":{},\"wrap\":false,\"transformers\":[]},\"remarkPlugins\":[null],\"rehypePlugins\":[[null,{}]],\"remarkRehype\":{},\"gfm\":true,\"smartypants\":true},\"security\":{\"checkOrigin\":true,\"allowedDomains\":[]},\"env\":{\"schema\":{},\"validateSecrets\":false},\"experimental\":{\"clientPrerender\":false,\"contentIntellisense\":false,\"headingIdCompat\":false,\"preserveScriptOrder\":false,\"liveContentCollections\":false,\"csp\":false,\"staticImportMetaEnv\":false,\"chromeDevtoolsWorkspace\":false,\"failOnPrerenderConflict\":false,\"svgo\":false},\"legacy\":{\"collections\":false}}","blog",["Map",11,12,159,160,204,205,272,273],"fb-utis-engagement",{"id":11,"data":13,"body":26,"filePath":27,"digest":28,"rendered":29,"legacyId":158},{"title":14,"description":15,"pubDate":16,"author":17,"tags":18,"featured":25},"Why Facebook is Finally Asking What You Actually Want to See","For years, social media algorithms have been like silent observers. They watched how long you lingered on a video, whether you hit the like button, or if you sent a reel to a friend. While these passive signals helped build the feeds we see today, they had a major flaw: watching something doesn't always mean you enjoyed it. Sometimes, we watch things out of habit, shock, or because we simply forgot to scroll. The Shift to True Interest: Meta engineers realized that to build a better Facebook Reels experience, they needed to stop guessing and start listening. This led to the creation of the User True Interest Survey (UTIS) model. Instead of just tracking your data, Meta began integrating direct feedback—asking users through mini-surveys if a video actually matched their personal interests.",["Date","2026-01-17T00:00:00.000Z"],"Manish Dwibedy",[19,20,21,22,23,24],"MachineLearning","RecommendationSystems","MetaEngineering","UserExperience","DataScience","AI",true,"# High Level Overview\n\n## 1. Beyond the \"Click\": Why Watch Time Isn't Enough\n\nFor years, the \"Golden Rule\" of RecSys was **engagement = interest**. If someone watched a Reel to the end, the system assumed they loved it.\n\n* **The Reality Gap:** 15+ year veterans know this as the \"Clickbait Trap.\" Users often watch content out of shock, boredom, or \"hate-watching,\" which actually leads to long-term fatigue and platform churn.\n* **The Heuristic Failure:** Before UTIS, Meta used **interest heuristics** (rule-based guesses like \"If user watches >80%, interest = true\"). The engineering blog reveals these rules only hit **48.3% precision**.\n* **Insight:** True interest is **multi-dimensional**. It’s not just the topic; it’s the **mood** (energy level), **production style** (lo-fi vs. cinematic), and **audio motivation** (trending sound vs. original score).\n\n## 2. The UTIS Model: Real-Time Listening at Scale\n\nHow do you turn a subjective feeling into a math problem? You ask.\n\n* **The Feedback Loop:** Meta implemented randomized, in-context surveys asking, *“To what extent does this video match your interests?”* on a 1-5 scale.\n* **Architectural Challenge (Bias Correction):** For the junior dev, a survey seems simple. For the senior architect, the challenge is **Selection Bias**. People who answer surveys are different from those who don't.\n* **The Fix:** Meta applies **Inverse Probability Weighting** to correct for sampling and non-response bias, ensuring the \"Ground Truth\" dataset reflects the *entire* user base, not just the talkative 1%.\n\n## 3. The \"Perception Layer\": Generalizing Sparse Feedback\n\nIn a system with billions of views, getting 100,000 surveys is still \"sparse data.\" You can't train a massive Deep Neural Network on 0.01% of your data.\n\n* **The Solution:** A lightweight **Perception Layer** (Alignment Model).\n* **Feature Engineering:** Instead of learning from raw video pixels, this layer uses the **existing predictions** of the main Multi-Task Ranking model as its inputs. It essentially \"re-interprets\" what the main model already knows.\n* **Denoising via Binarization:** Humans are inconsistent—one person's \"4\" is another's \"5.\" To stabilize the gradient, Meta **binarizes** responses (e.g., 4 and 5 become \"Satisfied\"). This reduces variance and makes the model converge faster.\n\n## 4. Re-Engineering the Funnel: LSR & Knowledge Distillation\n\nThis is the \"meat\" of the 2026 update. The model doesn't just sit at the end; it influences the entire journey.\n\n* **Late Stage Ranking (LSR):** UTIS scores act as a \"Value Formula\" adjustment. If a video is viral but has low predicted UTIS interest, it gets a **penalty**. If it’s a niche hobby video with high predicted interest, it gets a **boost**.\n* **Knowledge Distillation (For Senior Engineers):** Retrieval models (the \"Early Stage\") need to be fast, so they can't run complex UTIS logic. Meta uses **Distillation**, where the complex LSR model acts as a \"Teacher,\" providing \"soft labels\" to the simpler Retrieval \"Student\" model. This aligns the early search with the late-stage quality goals.\n\n## 5. Proven Results: The 10-Million User Test\n\nMeta’s A/B tests on 10M+ users provided the \"Proof of Concept\" for this value-based approach.\n\n### Key Performance Metrics\n\n* **Total Engagement (+5.2%):** The \"Holy Grail\"—proving that quality-based ranking increases time spent.\n* **Low Survey Ratings (-6.84%):** A massive win for user sentiment and overall satisfaction.\n* **Integrity Violations (-0.34%):** Better interest matching led to a natural drop in violations.\n\n**Core Insight:** When users see what they *actually* care about, they are less likely to encounter (or engage with) toxic or \"borderline\" content.\n\n## 6. The 2026 Horizon: Data Sparsity & LLMs\n\nThe blog ends with the \"Hard Problems\" still being solved.\n\n* **The Cold Start Problem:** How do you predict \"True Interest\" for a user who hasn't watched anything yet? Meta is focusing on **Sparse Engagement History**—using cross-domain signals (like what they do on Facebook Groups) to seed the Reels engine.\n* **LLMs and Semantic IDs:** Moving forward, Meta is exploring **Large Language Models** to move beyond hashtags. LLMs can \"watch\" a video and understand that a \"mood\" is \"calm/meditative\" vs \"energetic/chaotic,\" allowing for much deeper personalization than simple category tags.\n\n\u003Cbr/>\n\u003Chr style=\"height:2px; border:none; color:#333; background-color:#333;\">\n\u003Cbr/>\n\n> Incase you are interersted to look into it deeper, let us cover each of them in much more details. Please feel free to skip it if you want to have an overview and don't need to dive much deeper.\n\n## 1. Beyond the \"Click\": Why Watch Time Isn't Enough\n\nFor years, the \"Golden Rule\" of Recommendation Systems (RecSys) was a simple equation: **High Engagement = User Satisfaction.** If a user watched a Reel to the end or re-watched it, the system logged a \"Success.\" However, the 2026 Meta engineering update reveals that this logic has reached a point of diminishing returns.\n\n### The Problem: The \"Passive Signal\" Trap\n\nImplicit signals—likes, shares, and watch time—are easy to track but notoriously \"noisy.\" They capture **short-term attention**, not **long-term utility**.\n\n* **Junior Insight:** Think of a \"car crash\" video. You might watch it intently for 30 seconds, but that doesn't mean you want a feed full of accidents. Traditional models treat that 30 seconds of \"shock\" the same as 30 seconds of a \"cooking tutorial\" you genuinely love.\n* **Senior Insight:** This is a classic **Proxy Objective** problem. We optimize for watch time because it’s a measurable proxy for value, but it eventually diverges from the true objective: user retention and sentiment. Meta's data showed that interest heuristics (rules of thumb) based on these signals only achieved **48.3% precision** in identifying what users actually cared about.\n\n### The Complexity of \"True Interest\"\n\nTrue interest isn't just a label (e.g., \"Dogs\" or \"Tech\"). The Meta report highlights that effective matching is multi-dimensional. It now accounts for:\n\n* **Audio and Production Style:** Does the user prefer lo-fi, raw content or high-production, cinematic Reels?\n* **Mood and Motivation:** Is the user in a \"learning mode\" (tutorials) or an \"escape mode\" (comedy)?\n* **The Novelty Factor:** Does the user want more of the same, or are they looking for something niche and fresh that hasn't gone viral yet?\n\n### The Technical Pivot: From \"Heuristics\" to \"Perception\"\n\nPreviously, engineers used **Heuristics**—manually tuned rules like:\n\n> *“If (WatchTime > 80% of VideoLength) AND (IsRe-watched), then Interest = 1”*\n\nThe 2026 update marks the move away from these rigid rules toward the **UTIS (User True Interest Survey) model**. By moving the ground truth from *actions* (what they did) to *perceptions* (what they said), Meta successfully improved interest identification accuracy from **59.5% to 71.5%**.\n\n> **Key Takeaway:** In 2026, the industry is shifting from an \"Economy of Attention\" (how long can we keep them?) to an **\"Economy of Value\"** (how well did we match their intent?).\n\n\n\n## 2. Data Collection: Measuring User Perception\n\nTo build a model that understands \"True Interest,\" you first need a dataset that isn't based on guesses. Meta’s solution was to go straight to the source: the users. However, for an engineer, the challenge isn't just asking the question—it’s ensuring the answers aren't lying to you.\n\n### The Mechanism: In-Context Micro-Surveys\n\nMeta deployed a large-scale, randomized survey framework within the Facebook Reels feed.\n\n* **The Workflow:** During a viewing session, a user is randomly served a single-question survey: *“To what extent does this video match your interests?”* * **The Scale:** Responses are captured on a **1–5 Likert scale**.\n* **The \"In-Context\" Advantage:** Unlike a broad email survey sent a week later, these are \"in-the-moment.\" This captures the immediate **perception** and **emotional resonance** of the content, which is far more accurate for training an AI than delayed feedback.\n\n### The \"Sampling Bias\" Challenge\n\nAny data scientist will tell you: **Survey data is biased by nature.**\n\n* **The Junior Perspective:** You might think, *\"We have thousands of responses, that’s plenty of data!\"* * **The Senior Perspective:** The problem is **Nonresponse Bias**. People who choose to answer surveys are fundamentally different from those who skip them. They might be more opinionated, more tech-savvy, or simply have more free time. If you train a model only on their data, you’re building a \"Recommender for People Who Like Surveys,\" which will fail for the other 95% of your users.\n\n### The Engineering Solution: Statistical Weighting\n\nTo fix this, the January 2026 report details how Meta uses **Inverse Probability Weighting** to \"de-bias\" the results.\n\n1. **Propensity Scoring:** They calculate the probability () that a certain type of user will respond to a survey based on their historical behavior and demographics.\n2. **Reweighting:** If a \"quiet\" user (who rarely takes surveys) actually takes one, their response is given a higher weight (e.g., ).\n3. **Outcome:** This creates a **synthetic representative sample**. It ensures that the final training set accurately reflects the preferences of the entire global user base, not just the \"active responders.\"\n\n### Why This Matters for the Model\n\nBy correcting these biases, Meta moved their alignment with true interests from a shaky **48.3%** to over **70%**. This high-fidelity dataset serves as the foundation for the **Perception Layer**—the \"brain\" that finally teaches the machine what \"quality\" actually feels like to a human.\n\n> **Key Takeaway:** Large-scale feedback is useless if it’s skewed. The real engineering \"magic\" isn't in the survey itself, but in the **statistical correction** that makes sparse, biased feedback act like universal truth.\n\n\n\n## 3. The UTIS Model Architecture: The Perception Layer\n\nAt the scale of billions of Reels, direct survey feedback is \"gold,\" but it’s also rare. If you tried to train a massive neural network using *only* survey responses, the model would never converge because there simply isn't enough data. Meta’s solution is a brilliant bit of modular engineering: the **Perception Layer**.\n\n### The Architecture: A Lightweight Alignment Layer\n\nInstead of building a brand-new, end-to-end model, Meta engineers added a lightweight \"Alignment Model\" on top of their existing infrastructure.\n\n* **The Inputs (Feature Engineering):** The UTIS model doesn't look at raw video pixels or audio files from scratch. Instead, it uses the **existing predictions** from Meta’s primary multi-task, multi-label ranking model as its input features.\n* **Junior Insight:** Think of it as a \"Smart Filter.\" The big ranking model already knows if a video is about dogs or cooking. The UTIS layer just learns to interpret those existing signals through the lens of user satisfaction.\n* **Senior Insight:** This is essentially a **Transfer Learning** strategy. By using the outputs of a massive, pre-trained model as inputs for a smaller \"perception\" model, Meta can train a highly accurate satisfaction predictor with far less data than a standalone model would require.\n\n### The Denoising Secret: Data Binarization\n\nOne of the most interesting technical choices in the 2026 report is the move to **binarize** survey responses.\n\n* **The Problem with 1-5 Scales:** Humans are subjective. User A might give a video they liked a \"4,\" while User B gives the exact same experience a \"5.\" This variance creates \"noise\" in the loss function, making it harder for the model to learn the difference between \"good\" and \"great.\"\n* **The Fix:** Meta binarizes the labels (e.g., converting 4s and 5s into a \"1\" for satisfied, and 1-3 into a \"0\").\n* **The Result:** This simplifies the modeling task into a **binary classification problem**, which is much more stable and generalizes better across different types of users. It removes the \"noise\" of individual rating styles while keeping the core signal of satisfaction.\n\n### Interpretable Design\n\nMeta specifically designed the UTIS model to be **interpretable**. Because the model is lightweight and uses clearly defined features (user behavior, content attributes, and interest signals), engineers can see *why* the model thinks a video matches an interest. This \"White Box\" approach allows for faster debugging and more transparent AI behavior compared to \"Black Box\" deep learning.\n\n> **Key Takeaway:** You don't always need a bigger model; sometimes you just need a better **alignment layer**. By stacking a lightweight perception model on top of their existing heavy-lifters, Meta turned sparse survey data into a powerful, system-wide ranking signal.\n\n\n\n## 4. System Integration: How UTIS Reshapes the Funnel\n\nA common challenge for recommendation engineers is the **funnel trade-off**: your early stages (Retrieval) need to be lightning-fast but are often \"dumb,\" while your late stages (Ranking) are \"smart\" but computationally expensive. Meta solved this by injecting the UTIS model's \"perception\" into both ends of the funnel.\n\n### Late Stage Ranking (LSR): The Final Quality Control\n\nIn the final ranking stage, the system has already narrowed the pool down to a few hundred candidates. Here, the UTIS model runs in parallel with the main ranking model.\n\n* **The Value Formula:** UTIS provides a \"probability of satisfaction\" score that is injected directly into the **Final Value Formula**.\n* **The \"Boost and Demote\" Logic:** Instead of completely overriding the system, UTIS acts as a stabilizer. Videos with high predicted \"True Interest\" receive a modest score boost, while \"Clickbait\" (high watch time but low predicted survey rating) gets demoted.\n* **Senior Insight:** This is a **Multi-Objective Optimization (MOO)** win. By adding UTIS as a feature rather than a hard filter, Meta can balance engagement (watch time) with quality (survey satisfaction) without causing a collapse in total views.\n\n### Early Stage Ranking (Retrieval): Finding the Niche\n\nThe most impressive part of the 2026 update is how UTIS influences the **Retrieval** stage—the \"Big Net\" that catches the first 1,000 candidates.\n\n### Key Engineering Concepts\n\n* **Interest Profile Reconstruction:** Meta uses aggregated survey data to \"re-build\" what the system thinks you like. \n\nIf you rate \"Woodworking\" 5/5 but watch \"Prank\" videos because they are loud, the system proactively sources woodworking content regardless of virality.\n\n\n\n\n\n* **Knowledge Distillation:** Let's check their Engineering Secret\n\nLet's Bridge the sophistication and scale using the 3-Step Distillation Pipeline.\n\n  1. **The Challenge:** \n  \n  Retrieval models (like Two-Tower networks) are too simple to run the complex UTIS Perception Layer logic.\n\n  2. **The Solution:** \n  \n  Meta uses the \"smart\" LSR UTIS model as a **Teacher** and the \"fast\" Retrieval model as a **Student**.\n\n  3. **The Process:** \n  \n  The student mimics the teacher's scores, distilling sophisticated matching logic into a fast, deployable format.\n\n> **Junior Insight:** Imagine a professor (LSR) writing a complex textbook and a student (Retrieval) making \"Cheat Sheet\" notes. The student doesn't know *why* the math works as well as the professor, but they can give you the right answer in half the time.\n\n\n### The Ecosystem Shift\n\nBy aligning the entire funnel—from the first search to the final rank—Meta has shifted the platform's DNA. This integration is why the system can now surface **niche, high-quality content** that traditional \"popularity-based\" algorithms would have filtered out in the first five milliseconds.\n\n> **Key Takeaway:** Real impact happens when you align your \"fast\" and \"smart\" models. Using **Knowledge Distillation** ensures that your system doesn't just rank well at the end, but actually looks for the right things from the very beginning.\n\n\n\n## 5. Performance Results: The Impact of \"Listening\"\n\nFor any engineer, the true test of a model is the **A/B test**. Meta conducted a massive experiment with over **10 million users** to see if the UTIS model could outperform the traditional \"Passive Signal\" engines. The results weren't just positive; they were transformative across three major dimensions: Engagement, Satisfaction, and Platform Health.\n\n### The \"Hard\" Metrics: Proving Quality Drives Engagement\n\nOne of the biggest fears in RecSys is that \"cleaning up\" the feed (removing clickbait) will lead to lower watch time. The 2026 data debunked this:\n\n* **+5.2% Total Engagement:** By showing users content that matched their *true* interests rather than just what they were \"stuck\" watching, Meta actually saw a significant increase in total time spent and interaction rates.\n* **The Follow/Share Boost:** Because the content felt more \"personal\" and \"niche,\" users were more likely to follow creators and share videos, which are high-intent actions that drive long-term platform health.\n\n### The \"Sentiment\" Metrics: Closing the Satisfaction Gap\n\nThe primary goal of UTIS was to align the AI's \"guesses\" with the user's \"feelings.\"\n\n* **+5.4% Increase in High Survey Ratings:** Users were more frequently seeing content they rated as a \"4\" or \"5.\"\n* **-6.84% Reduction in Low Ratings:** This is a massive win for **churn reduction**. Most users leave a platform not because they are bored, but because they are frustrated by irrelevant or \"junk\" content.\n\n### The Surprise Win: -0.34% Integrity Violations\n\nPerhaps the most interesting insight for senior engineers and policy-makers is the drop in **Integrity Violations**.\n\n* **Junior Insight:** Why would an \"interest\" model stop \"bad\" content?\n* **Senior Insight:** Much of the toxic or \"borderline\" content on social media thrives on **shock value**. These videos get high \"Watch Time\" but very low \"True Interest\" scores from users.\n* **The Logic:** Because the UTIS model demotes content that has high engagement but low survey satisfaction, it naturally \"starves\" clickbait and sensationalist content of distribution. When you stop optimizing for \"eyes on screen\" and start optimizing for \"value in mind,\" the system naturally filters out a significant portion of harmful content without needing a separate censorship layer.\n\n> **Key Takeaway:** Better matching isn't just about fun; it’s about **safety and sustainability**. When your AI understands what a user *values*, it stops being tricked by content that is merely *loud*.\n\n\n\n## 6. Future Directions: LLMs and the \"Cold Start\" Problem\n\nThe 2026 Meta Engineering report makes it clear: the work isn't done. While the UTIS model works wonders for active users, the system still faces two major technical hurdles: **Data Scarcity** for new users and the limitation of **Semantic Understanding**.\n\n### Solving the \"Cold Start\" (Sparse Engagement History)\n\nThe biggest challenge for any recommendation engine is the \"New User.\" If someone just joined Facebook or rarely watches Reels, the UTIS model has no \"True Interest\" survey data to work with.\n\n* **The \"Andromeda\" Approach:** Meta is moving toward a more holistic cross-platform signal system. If a new user has joined a \"Vintage Camera Restoration\" group on Facebook, the Reels engine can now proactively \"seed\" their feed with related niche content, even before they’ve watched a single video.\n* **User-Led Control:** In early 2026, Meta rolled out \"Your Algorithm\" controls, allowing users to manually select and \"pin\" top topics (like #Snowboarding or #Meditation). This provides an immediate **explicit signal** that bypasses the need for weeks of behavioral data.\n\n### LLMs: Understanding the \"Vibe\"\n\nCurrent models are great at recognizing objects (e.g., \"This video has a cat\"), but they struggle with **abstract nuances** like mood, humor, or production quality.\n\n* **Beyond Hashtags:** Meta is testing **Large Language Models (LLMs)** to \"watch\" and describe videos in plain English. Instead of a video being tagged as `#Cooking`, an LLM can identify it as a *\"calm, lo-fi ASMR baking video with a nostalgic 1970s aesthetic.\"*\n* **The Technical Challenge:** For 15+ year engineers, the hurdle here is **Inference Latency**. Running a massive LLM for every video in the retrieval pool is computationally impossible. Meta’s future strategy involves using LLMs to generate \"Semantic Embeddings\"—dense math vectors that capture the \"vibe\"—which are then stored and used by the faster ranking models.\n\n### Knowledge Distillation 2.0\n\nMeta is doubling down on **Knowledge Distillation** to keep the system fast.\n\n* **The \"Teacher\" becomes the \"GenAI\":** In the future, the \"Teacher\" model won't just be based on survey results; it will be a multimodal AI that understands text, audio, and video context.\n* **The \"Student\" (Retrieval):** The student model will be trained to find videos that match a user's **Current Intent** (e.g., \"I want to learn something\") vs. their **General Interest** (e.g., \"I like comedy\").\n\n### The Ultimate Goal: Diversity over Viralism\n\nThe roadmap for late 2026 focuses on **Content Diversity**. Meta’s research shows that even if you love one topic, seeing too much of it leads to \"Content Fatigue.\" The next iteration of the UTIS framework will include a **\"Novelty Penalty\"**—intentionally injecting high-quality, niche content from *unrelated* fields to see if it sparks a new \"True Interest.\"\n\n> **Key Takeaway:** The future of AI at Meta isn't just about predicting the next click; it’s about **anticipating human evolution**. By combining user-led controls with Generative AI’s ability to understand \"mood,\" Meta is building a feed that feels less like a machine and more like a personal curator.\n\n\n## Conclusion: The New Standard for Social Discovery\n\nThe shift from passive engagement to the **User True Interest Survey (UTIS)** model marks the end of an era for Facebook Reels. For years, the industry was locked in a \"Watch Time War,\" where success was measured by how long we could keep eyes on a screen. Meta’s 2026 update proves that the next frontier is **Value-Based Recommendation.**\n\nBy integrating the Perception Layer across the entire funnel—from the split-second retrieval stage to the final value ranking—Meta has built a system that finally respects the \"Human in the Loop.\"\n\n### Executive Summary: The Technical \"TL;DR\"\n\n\n\u003Cdiv style=\"overflow-x:auto; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\">\n  \u003Ctable style=\"border-collapse: collapse; width: 100%; box-shadow: 0 4px 8px rgba(0,0,0,0.1); border-radius: 8px; overflow: hidden;\">\n    \u003Cthead>\n      \u003Ctr style=\"background-color: #2c3e50; color: white; text-align: left;\">\n        \u003Cth style=\"padding: 15px; border-bottom: 2px solid #1a252f;\">Feature\u003C/th>\n        \u003Cth style=\"padding: 15px; border-bottom: 2px solid #1a252f;\">Old System (Heuristic-Based)\u003C/th>\n        \u003Cth style=\"padding: 15px; border-bottom: 2px solid #1a252f;\">New System (UTIS Model)\u003C/th>\n      \u003C/tr>\n    \u003C/thead>\n    \u003Ctbody style=\"background-color: #ffffff; color: #333;\">\n      \u003Ctr style=\"border-bottom: 1px solid #eee;\">\n        \u003Ctd style=\"padding: 12px 15px; font-weight: 600; background-color: #f8f9fa;\">Primary Signal\u003C/td>\n        \u003Ctd style=\"padding: 12px 15px;\">Implicit (Watch time, Likes)\u003C/td>\n        \u003Ctd style=\"padding: 12px 15px;\">Explicit (Survey-verified Interest)\u003C/td>\n      \u003C/tr>\n      \u003Ctr style=\"border-bottom: 1px solid #eee; background-color: #fdfdfd;\">\n        \u003Ctd style=\"padding: 12px 15px; font-weight: 600; background-color: #f8f9fa;\">Accuracy\u003C/td>\n        \u003Ctd style=\"padding: 12px 15px; color: #e67e22;\">48.3% Precision\u003C/td>\n        \u003Ctd style=\"padding: 12px 15px; color: #27ae60; font-weight: bold;\">71.5% Accuracy\u003C/td>\n      \u003C/tr>\n      \u003Ctr style=\"border-bottom: 1px solid #eee;\">\n        \u003Ctd style=\"padding: 12px 15px; font-weight: 600; background-color: #f8f9fa;\">Funnel Strategy\u003C/td>\n        \u003Ctd style=\"padding: 12px 15px;\">Late-stage filtering only\u003C/td>\n        \u003Ctd style=\"padding: 12px 15px;\">Deep integration via Knowledge Distillation\u003C/td>\n      \u003C/tr>\n      \u003Ctr style=\"border-bottom: 1px solid #eee; background-color: #fdfdfd;\">\n        \u003Ctd style=\"padding: 12px 15px; font-weight: 600; background-color: #f8f9fa;\">User Impact\u003C/td>\n        \u003Ctd style=\"padding: 12px 15px;\">”Pop” viral content dominant\u003C/td>\n        \u003Ctd style=\"padding: 12px 15px;\">High-quality, Niche content boost\u003C/td>\n      \u003C/tr>\n      \u003Ctr>\n        \u003Ctd style=\"padding: 12px 15px; font-weight: 600; background-color: #f8f9fa;\">Ecosystem\u003C/td>\n        \u003Ctd style=\"padding: 12px 15px;\">Optimized for Attention\u003C/td>\n        \u003Ctd style=\"padding: 12px 15px; font-weight: bold; color: #2980b9;\">Optimized for Long-term Utility\u003C/td>\n      \u003C/tr>\n    \u003C/tbody>\n  \u003C/table>\n\u003C/div>\n\n### Key Insights for the Engineering Community\n\n* **1-2 Year Engineers:** Focus on the importance of **Ground Truth**. No matter how complex your neural network is, it is only as good as the data labels you feed it. Moving from \"guessing\" (heuristics) to \"asking\" (surveys) is often more impactful than adding a billion parameters.\n* **Senior Architects (15+ Years):** The real innovation here is **Alignment.** By using the smart LSR model to \"teach\" the retrieval models through **Knowledge Distillation**, Meta solved the latency-vs-intelligence trade-off. This allows high-level human perception to influence low-level, high-speed candidate sourcing.\n\n### Final Thought\n\nAs we move further into 2026, the definition of a \"good\" algorithm is changing. It’s no longer just about predicting the next click; it’s about understanding the **intent, mood, and motivation** behind the human using the device. The UTIS model is a significant step toward an AI that doesn't just watch us, but actually understands us.","src/content/blog/fb-utis-engagement.md","4d06ced47d93804f",{"html":30,"metadata":31},"\u003Ch1 id=\"high-level-overview\">High Level Overview\u003C/h1>\n\u003Ch2 id=\"1-beyond-the-click-why-watch-time-isnt-enough\">1. Beyond the “Click”: Why Watch Time Isn’t Enough\u003C/h2>\n\u003Cp>For years, the “Golden Rule” of RecSys was \u003Cstrong>engagement = interest\u003C/strong>. If someone watched a Reel to the end, the system assumed they loved it.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>The Reality Gap:\u003C/strong> 15+ year veterans know this as the “Clickbait Trap.” Users often watch content out of shock, boredom, or “hate-watching,” which actually leads to long-term fatigue and platform churn.\u003C/li>\n\u003Cli>\u003Cstrong>The Heuristic Failure:\u003C/strong> Before UTIS, Meta used \u003Cstrong>interest heuristics\u003C/strong> (rule-based guesses like “If user watches >80%, interest = true”). The engineering blog reveals these rules only hit \u003Cstrong>48.3% precision\u003C/strong>.\u003C/li>\n\u003Cli>\u003Cstrong>Insight:\u003C/strong> True interest is \u003Cstrong>multi-dimensional\u003C/strong>. It’s not just the topic; it’s the \u003Cstrong>mood\u003C/strong> (energy level), \u003Cstrong>production style\u003C/strong> (lo-fi vs. cinematic), and \u003Cstrong>audio motivation\u003C/strong> (trending sound vs. original score).\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"2-the-utis-model-real-time-listening-at-scale\">2. The UTIS Model: Real-Time Listening at Scale\u003C/h2>\n\u003Cp>How do you turn a subjective feeling into a math problem? You ask.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>The Feedback Loop:\u003C/strong> Meta implemented randomized, in-context surveys asking, \u003Cem>“To what extent does this video match your interests?”\u003C/em> on a 1-5 scale.\u003C/li>\n\u003Cli>\u003Cstrong>Architectural Challenge (Bias Correction):\u003C/strong> For the junior dev, a survey seems simple. For the senior architect, the challenge is \u003Cstrong>Selection Bias\u003C/strong>. People who answer surveys are different from those who don’t.\u003C/li>\n\u003Cli>\u003Cstrong>The Fix:\u003C/strong> Meta applies \u003Cstrong>Inverse Probability Weighting\u003C/strong> to correct for sampling and non-response bias, ensuring the “Ground Truth” dataset reflects the \u003Cem>entire\u003C/em> user base, not just the talkative 1%.\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"3-the-perception-layer-generalizing-sparse-feedback\">3. The “Perception Layer”: Generalizing Sparse Feedback\u003C/h2>\n\u003Cp>In a system with billions of views, getting 100,000 surveys is still “sparse data.” You can’t train a massive Deep Neural Network on 0.01% of your data.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>The Solution:\u003C/strong> A lightweight \u003Cstrong>Perception Layer\u003C/strong> (Alignment Model).\u003C/li>\n\u003Cli>\u003Cstrong>Feature Engineering:\u003C/strong> Instead of learning from raw video pixels, this layer uses the \u003Cstrong>existing predictions\u003C/strong> of the main Multi-Task Ranking model as its inputs. It essentially “re-interprets” what the main model already knows.\u003C/li>\n\u003Cli>\u003Cstrong>Denoising via Binarization:\u003C/strong> Humans are inconsistent—one person’s “4” is another’s “5.” To stabilize the gradient, Meta \u003Cstrong>binarizes\u003C/strong> responses (e.g., 4 and 5 become “Satisfied”). This reduces variance and makes the model converge faster.\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"4-re-engineering-the-funnel-lsr--knowledge-distillation\">4. Re-Engineering the Funnel: LSR &#x26; Knowledge Distillation\u003C/h2>\n\u003Cp>This is the “meat” of the 2026 update. The model doesn’t just sit at the end; it influences the entire journey.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Late Stage Ranking (LSR):\u003C/strong> UTIS scores act as a “Value Formula” adjustment. If a video is viral but has low predicted UTIS interest, it gets a \u003Cstrong>penalty\u003C/strong>. If it’s a niche hobby video with high predicted interest, it gets a \u003Cstrong>boost\u003C/strong>.\u003C/li>\n\u003Cli>\u003Cstrong>Knowledge Distillation (For Senior Engineers):\u003C/strong> Retrieval models (the “Early Stage”) need to be fast, so they can’t run complex UTIS logic. Meta uses \u003Cstrong>Distillation\u003C/strong>, where the complex LSR model acts as a “Teacher,” providing “soft labels” to the simpler Retrieval “Student” model. This aligns the early search with the late-stage quality goals.\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"5-proven-results-the-10-million-user-test\">5. Proven Results: The 10-Million User Test\u003C/h2>\n\u003Cp>Meta’s A/B tests on 10M+ users provided the “Proof of Concept” for this value-based approach.\u003C/p>\n\u003Ch3 id=\"key-performance-metrics\">Key Performance Metrics\u003C/h3>\n\u003Cul>\n\u003Cli>\u003Cstrong>Total Engagement (+5.2%):\u003C/strong> The “Holy Grail”—proving that quality-based ranking increases time spent.\u003C/li>\n\u003Cli>\u003Cstrong>Low Survey Ratings (-6.84%):\u003C/strong> A massive win for user sentiment and overall satisfaction.\u003C/li>\n\u003Cli>\u003Cstrong>Integrity Violations (-0.34%):\u003C/strong> Better interest matching led to a natural drop in violations.\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Core Insight:\u003C/strong> When users see what they \u003Cem>actually\u003C/em> care about, they are less likely to encounter (or engage with) toxic or “borderline” content.\u003C/p>\n\u003Ch2 id=\"6-the-2026-horizon-data-sparsity--llms\">6. The 2026 Horizon: Data Sparsity &#x26; LLMs\u003C/h2>\n\u003Cp>The blog ends with the “Hard Problems” still being solved.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>The Cold Start Problem:\u003C/strong> How do you predict “True Interest” for a user who hasn’t watched anything yet? Meta is focusing on \u003Cstrong>Sparse Engagement History\u003C/strong>—using cross-domain signals (like what they do on Facebook Groups) to seed the Reels engine.\u003C/li>\n\u003Cli>\u003Cstrong>LLMs and Semantic IDs:\u003C/strong> Moving forward, Meta is exploring \u003Cstrong>Large Language Models\u003C/strong> to move beyond hashtags. LLMs can “watch” a video and understand that a “mood” is “calm/meditative” vs “energetic/chaotic,” allowing for much deeper personalization than simple category tags.\u003C/li>\n\u003C/ul>\n\u003Cbr>\n\u003Chr style=\"height:2px; border:none; color:#333; background-color:#333;\">\n\u003Cbr>\n\u003Cblockquote>\n\u003Cp>Incase you are interersted to look into it deeper, let us cover each of them in much more details. Please feel free to skip it if you want to have an overview and don’t need to dive much deeper.\u003C/p>\n\u003C/blockquote>\n\u003Ch2 id=\"1-beyond-the-click-why-watch-time-isnt-enough-1\">1. Beyond the “Click”: Why Watch Time Isn’t Enough\u003C/h2>\n\u003Cp>For years, the “Golden Rule” of Recommendation Systems (RecSys) was a simple equation: \u003Cstrong>High Engagement = User Satisfaction.\u003C/strong> If a user watched a Reel to the end or re-watched it, the system logged a “Success.” However, the 2026 Meta engineering update reveals that this logic has reached a point of diminishing returns.\u003C/p>\n\u003Ch3 id=\"the-problem-the-passive-signal-trap\">The Problem: The “Passive Signal” Trap\u003C/h3>\n\u003Cp>Implicit signals—likes, shares, and watch time—are easy to track but notoriously “noisy.” They capture \u003Cstrong>short-term attention\u003C/strong>, not \u003Cstrong>long-term utility\u003C/strong>.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Junior Insight:\u003C/strong> Think of a “car crash” video. You might watch it intently for 30 seconds, but that doesn’t mean you want a feed full of accidents. Traditional models treat that 30 seconds of “shock” the same as 30 seconds of a “cooking tutorial” you genuinely love.\u003C/li>\n\u003Cli>\u003Cstrong>Senior Insight:\u003C/strong> This is a classic \u003Cstrong>Proxy Objective\u003C/strong> problem. We optimize for watch time because it’s a measurable proxy for value, but it eventually diverges from the true objective: user retention and sentiment. Meta’s data showed that interest heuristics (rules of thumb) based on these signals only achieved \u003Cstrong>48.3% precision\u003C/strong> in identifying what users actually cared about.\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"the-complexity-of-true-interest\">The Complexity of “True Interest”\u003C/h3>\n\u003Cp>True interest isn’t just a label (e.g., “Dogs” or “Tech”). The Meta report highlights that effective matching is multi-dimensional. It now accounts for:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Audio and Production Style:\u003C/strong> Does the user prefer lo-fi, raw content or high-production, cinematic Reels?\u003C/li>\n\u003Cli>\u003Cstrong>Mood and Motivation:\u003C/strong> Is the user in a “learning mode” (tutorials) or an “escape mode” (comedy)?\u003C/li>\n\u003Cli>\u003Cstrong>The Novelty Factor:\u003C/strong> Does the user want more of the same, or are they looking for something niche and fresh that hasn’t gone viral yet?\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"the-technical-pivot-from-heuristics-to-perception\">The Technical Pivot: From “Heuristics” to “Perception”\u003C/h3>\n\u003Cp>Previously, engineers used \u003Cstrong>Heuristics\u003C/strong>—manually tuned rules like:\u003C/p>\n\u003Cblockquote>\n\u003Cp>\u003Cem>“If (WatchTime > 80% of VideoLength) AND (IsRe-watched), then Interest = 1”\u003C/em>\u003C/p>\n\u003C/blockquote>\n\u003Cp>The 2026 update marks the move away from these rigid rules toward the \u003Cstrong>UTIS (User True Interest Survey) model\u003C/strong>. By moving the ground truth from \u003Cem>actions\u003C/em> (what they did) to \u003Cem>perceptions\u003C/em> (what they said), Meta successfully improved interest identification accuracy from \u003Cstrong>59.5% to 71.5%\u003C/strong>.\u003C/p>\n\u003Cblockquote>\n\u003Cp>\u003Cstrong>Key Takeaway:\u003C/strong> In 2026, the industry is shifting from an “Economy of Attention” (how long can we keep them?) to an \u003Cstrong>“Economy of Value”\u003C/strong> (how well did we match their intent?).\u003C/p>\n\u003C/blockquote>\n\u003Ch2 id=\"2-data-collection-measuring-user-perception\">2. Data Collection: Measuring User Perception\u003C/h2>\n\u003Cp>To build a model that understands “True Interest,” you first need a dataset that isn’t based on guesses. Meta’s solution was to go straight to the source: the users. However, for an engineer, the challenge isn’t just asking the question—it’s ensuring the answers aren’t lying to you.\u003C/p>\n\u003Ch3 id=\"the-mechanism-in-context-micro-surveys\">The Mechanism: In-Context Micro-Surveys\u003C/h3>\n\u003Cp>Meta deployed a large-scale, randomized survey framework within the Facebook Reels feed.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>The Workflow:\u003C/strong> During a viewing session, a user is randomly served a single-question survey: \u003Cem>“To what extent does this video match your interests?”\u003C/em> * \u003Cstrong>The Scale:\u003C/strong> Responses are captured on a \u003Cstrong>1–5 Likert scale\u003C/strong>.\u003C/li>\n\u003Cli>\u003Cstrong>The “In-Context” Advantage:\u003C/strong> Unlike a broad email survey sent a week later, these are “in-the-moment.” This captures the immediate \u003Cstrong>perception\u003C/strong> and \u003Cstrong>emotional resonance\u003C/strong> of the content, which is far more accurate for training an AI than delayed feedback.\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"the-sampling-bias-challenge\">The “Sampling Bias” Challenge\u003C/h3>\n\u003Cp>Any data scientist will tell you: \u003Cstrong>Survey data is biased by nature.\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>The Junior Perspective:\u003C/strong> You might think, \u003Cem>“We have thousands of responses, that’s plenty of data!”\u003C/em> * \u003Cstrong>The Senior Perspective:\u003C/strong> The problem is \u003Cstrong>Nonresponse Bias\u003C/strong>. People who choose to answer surveys are fundamentally different from those who skip them. They might be more opinionated, more tech-savvy, or simply have more free time. If you train a model only on their data, you’re building a “Recommender for People Who Like Surveys,” which will fail for the other 95% of your users.\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"the-engineering-solution-statistical-weighting\">The Engineering Solution: Statistical Weighting\u003C/h3>\n\u003Cp>To fix this, the January 2026 report details how Meta uses \u003Cstrong>Inverse Probability Weighting\u003C/strong> to “de-bias” the results.\u003C/p>\n\u003Col>\n\u003Cli>\u003Cstrong>Propensity Scoring:\u003C/strong> They calculate the probability () that a certain type of user will respond to a survey based on their historical behavior and demographics.\u003C/li>\n\u003Cli>\u003Cstrong>Reweighting:\u003C/strong> If a “quiet” user (who rarely takes surveys) actually takes one, their response is given a higher weight (e.g., ).\u003C/li>\n\u003Cli>\u003Cstrong>Outcome:\u003C/strong> This creates a \u003Cstrong>synthetic representative sample\u003C/strong>. It ensures that the final training set accurately reflects the preferences of the entire global user base, not just the “active responders.”\u003C/li>\n\u003C/ol>\n\u003Ch3 id=\"why-this-matters-for-the-model\">Why This Matters for the Model\u003C/h3>\n\u003Cp>By correcting these biases, Meta moved their alignment with true interests from a shaky \u003Cstrong>48.3%\u003C/strong> to over \u003Cstrong>70%\u003C/strong>. This high-fidelity dataset serves as the foundation for the \u003Cstrong>Perception Layer\u003C/strong>—the “brain” that finally teaches the machine what “quality” actually feels like to a human.\u003C/p>\n\u003Cblockquote>\n\u003Cp>\u003Cstrong>Key Takeaway:\u003C/strong> Large-scale feedback is useless if it’s skewed. The real engineering “magic” isn’t in the survey itself, but in the \u003Cstrong>statistical correction\u003C/strong> that makes sparse, biased feedback act like universal truth.\u003C/p>\n\u003C/blockquote>\n\u003Ch2 id=\"3-the-utis-model-architecture-the-perception-layer\">3. The UTIS Model Architecture: The Perception Layer\u003C/h2>\n\u003Cp>At the scale of billions of Reels, direct survey feedback is “gold,” but it’s also rare. If you tried to train a massive neural network using \u003Cem>only\u003C/em> survey responses, the model would never converge because there simply isn’t enough data. Meta’s solution is a brilliant bit of modular engineering: the \u003Cstrong>Perception Layer\u003C/strong>.\u003C/p>\n\u003Ch3 id=\"the-architecture-a-lightweight-alignment-layer\">The Architecture: A Lightweight Alignment Layer\u003C/h3>\n\u003Cp>Instead of building a brand-new, end-to-end model, Meta engineers added a lightweight “Alignment Model” on top of their existing infrastructure.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>The Inputs (Feature Engineering):\u003C/strong> The UTIS model doesn’t look at raw video pixels or audio files from scratch. Instead, it uses the \u003Cstrong>existing predictions\u003C/strong> from Meta’s primary multi-task, multi-label ranking model as its input features.\u003C/li>\n\u003Cli>\u003Cstrong>Junior Insight:\u003C/strong> Think of it as a “Smart Filter.” The big ranking model already knows if a video is about dogs or cooking. The UTIS layer just learns to interpret those existing signals through the lens of user satisfaction.\u003C/li>\n\u003Cli>\u003Cstrong>Senior Insight:\u003C/strong> This is essentially a \u003Cstrong>Transfer Learning\u003C/strong> strategy. By using the outputs of a massive, pre-trained model as inputs for a smaller “perception” model, Meta can train a highly accurate satisfaction predictor with far less data than a standalone model would require.\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"the-denoising-secret-data-binarization\">The Denoising Secret: Data Binarization\u003C/h3>\n\u003Cp>One of the most interesting technical choices in the 2026 report is the move to \u003Cstrong>binarize\u003C/strong> survey responses.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>The Problem with 1-5 Scales:\u003C/strong> Humans are subjective. User A might give a video they liked a “4,” while User B gives the exact same experience a “5.” This variance creates “noise” in the loss function, making it harder for the model to learn the difference between “good” and “great.”\u003C/li>\n\u003Cli>\u003Cstrong>The Fix:\u003C/strong> Meta binarizes the labels (e.g., converting 4s and 5s into a “1” for satisfied, and 1-3 into a “0”).\u003C/li>\n\u003Cli>\u003Cstrong>The Result:\u003C/strong> This simplifies the modeling task into a \u003Cstrong>binary classification problem\u003C/strong>, which is much more stable and generalizes better across different types of users. It removes the “noise” of individual rating styles while keeping the core signal of satisfaction.\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"interpretable-design\">Interpretable Design\u003C/h3>\n\u003Cp>Meta specifically designed the UTIS model to be \u003Cstrong>interpretable\u003C/strong>. Because the model is lightweight and uses clearly defined features (user behavior, content attributes, and interest signals), engineers can see \u003Cem>why\u003C/em> the model thinks a video matches an interest. This “White Box” approach allows for faster debugging and more transparent AI behavior compared to “Black Box” deep learning.\u003C/p>\n\u003Cblockquote>\n\u003Cp>\u003Cstrong>Key Takeaway:\u003C/strong> You don’t always need a bigger model; sometimes you just need a better \u003Cstrong>alignment layer\u003C/strong>. By stacking a lightweight perception model on top of their existing heavy-lifters, Meta turned sparse survey data into a powerful, system-wide ranking signal.\u003C/p>\n\u003C/blockquote>\n\u003Ch2 id=\"4-system-integration-how-utis-reshapes-the-funnel\">4. System Integration: How UTIS Reshapes the Funnel\u003C/h2>\n\u003Cp>A common challenge for recommendation engineers is the \u003Cstrong>funnel trade-off\u003C/strong>: your early stages (Retrieval) need to be lightning-fast but are often “dumb,” while your late stages (Ranking) are “smart” but computationally expensive. Meta solved this by injecting the UTIS model’s “perception” into both ends of the funnel.\u003C/p>\n\u003Ch3 id=\"late-stage-ranking-lsr-the-final-quality-control\">Late Stage Ranking (LSR): The Final Quality Control\u003C/h3>\n\u003Cp>In the final ranking stage, the system has already narrowed the pool down to a few hundred candidates. Here, the UTIS model runs in parallel with the main ranking model.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>The Value Formula:\u003C/strong> UTIS provides a “probability of satisfaction” score that is injected directly into the \u003Cstrong>Final Value Formula\u003C/strong>.\u003C/li>\n\u003Cli>\u003Cstrong>The “Boost and Demote” Logic:\u003C/strong> Instead of completely overriding the system, UTIS acts as a stabilizer. Videos with high predicted “True Interest” receive a modest score boost, while “Clickbait” (high watch time but low predicted survey rating) gets demoted.\u003C/li>\n\u003Cli>\u003Cstrong>Senior Insight:\u003C/strong> This is a \u003Cstrong>Multi-Objective Optimization (MOO)\u003C/strong> win. By adding UTIS as a feature rather than a hard filter, Meta can balance engagement (watch time) with quality (survey satisfaction) without causing a collapse in total views.\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"early-stage-ranking-retrieval-finding-the-niche\">Early Stage Ranking (Retrieval): Finding the Niche\u003C/h3>\n\u003Cp>The most impressive part of the 2026 update is how UTIS influences the \u003Cstrong>Retrieval\u003C/strong> stage—the “Big Net” that catches the first 1,000 candidates.\u003C/p>\n\u003Ch3 id=\"key-engineering-concepts\">Key Engineering Concepts\u003C/h3>\n\u003Cul>\n\u003Cli>\u003Cstrong>Interest Profile Reconstruction:\u003C/strong> Meta uses aggregated survey data to “re-build” what the system thinks you like.\u003C/li>\n\u003C/ul>\n\u003Cp>If you rate “Woodworking” 5/5 but watch “Prank” videos because they are loud, the system proactively sources woodworking content regardless of virality.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Knowledge Distillation:\u003C/strong> Let’s check their Engineering Secret\u003C/li>\n\u003C/ul>\n\u003Cp>Let’s Bridge the sophistication and scale using the 3-Step Distillation Pipeline.\u003C/p>\n\u003Col>\n\u003Cli>\u003Cstrong>The Challenge:\u003C/strong>\u003C/li>\n\u003C/ol>\n\u003Cp>Retrieval models (like Two-Tower networks) are too simple to run the complex UTIS Perception Layer logic.\u003C/p>\n\u003Col start=\"2\">\n\u003Cli>\u003Cstrong>The Solution:\u003C/strong>\u003C/li>\n\u003C/ol>\n\u003Cp>Meta uses the “smart” LSR UTIS model as a \u003Cstrong>Teacher\u003C/strong> and the “fast” Retrieval model as a \u003Cstrong>Student\u003C/strong>.\u003C/p>\n\u003Col start=\"3\">\n\u003Cli>\u003Cstrong>The Process:\u003C/strong>\u003C/li>\n\u003C/ol>\n\u003Cp>The student mimics the teacher’s scores, distilling sophisticated matching logic into a fast, deployable format.\u003C/p>\n\u003Cblockquote>\n\u003Cp>\u003Cstrong>Junior Insight:\u003C/strong> Imagine a professor (LSR) writing a complex textbook and a student (Retrieval) making “Cheat Sheet” notes. The student doesn’t know \u003Cem>why\u003C/em> the math works as well as the professor, but they can give you the right answer in half the time.\u003C/p>\n\u003C/blockquote>\n\u003Ch3 id=\"the-ecosystem-shift\">The Ecosystem Shift\u003C/h3>\n\u003Cp>By aligning the entire funnel—from the first search to the final rank—Meta has shifted the platform’s DNA. This integration is why the system can now surface \u003Cstrong>niche, high-quality content\u003C/strong> that traditional “popularity-based” algorithms would have filtered out in the first five milliseconds.\u003C/p>\n\u003Cblockquote>\n\u003Cp>\u003Cstrong>Key Takeaway:\u003C/strong> Real impact happens when you align your “fast” and “smart” models. Using \u003Cstrong>Knowledge Distillation\u003C/strong> ensures that your system doesn’t just rank well at the end, but actually looks for the right things from the very beginning.\u003C/p>\n\u003C/blockquote>\n\u003Ch2 id=\"5-performance-results-the-impact-of-listening\">5. Performance Results: The Impact of “Listening”\u003C/h2>\n\u003Cp>For any engineer, the true test of a model is the \u003Cstrong>A/B test\u003C/strong>. Meta conducted a massive experiment with over \u003Cstrong>10 million users\u003C/strong> to see if the UTIS model could outperform the traditional “Passive Signal” engines. The results weren’t just positive; they were transformative across three major dimensions: Engagement, Satisfaction, and Platform Health.\u003C/p>\n\u003Ch3 id=\"the-hard-metrics-proving-quality-drives-engagement\">The “Hard” Metrics: Proving Quality Drives Engagement\u003C/h3>\n\u003Cp>One of the biggest fears in RecSys is that “cleaning up” the feed (removing clickbait) will lead to lower watch time. The 2026 data debunked this:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>+5.2% Total Engagement:\u003C/strong> By showing users content that matched their \u003Cem>true\u003C/em> interests rather than just what they were “stuck” watching, Meta actually saw a significant increase in total time spent and interaction rates.\u003C/li>\n\u003Cli>\u003Cstrong>The Follow/Share Boost:\u003C/strong> Because the content felt more “personal” and “niche,” users were more likely to follow creators and share videos, which are high-intent actions that drive long-term platform health.\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"the-sentiment-metrics-closing-the-satisfaction-gap\">The “Sentiment” Metrics: Closing the Satisfaction Gap\u003C/h3>\n\u003Cp>The primary goal of UTIS was to align the AI’s “guesses” with the user’s “feelings.”\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>+5.4% Increase in High Survey Ratings:\u003C/strong> Users were more frequently seeing content they rated as a “4” or “5.”\u003C/li>\n\u003Cli>\u003Cstrong>-6.84% Reduction in Low Ratings:\u003C/strong> This is a massive win for \u003Cstrong>churn reduction\u003C/strong>. Most users leave a platform not because they are bored, but because they are frustrated by irrelevant or “junk” content.\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"the-surprise-win--034-integrity-violations\">The Surprise Win: -0.34% Integrity Violations\u003C/h3>\n\u003Cp>Perhaps the most interesting insight for senior engineers and policy-makers is the drop in \u003Cstrong>Integrity Violations\u003C/strong>.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Junior Insight:\u003C/strong> Why would an “interest” model stop “bad” content?\u003C/li>\n\u003Cli>\u003Cstrong>Senior Insight:\u003C/strong> Much of the toxic or “borderline” content on social media thrives on \u003Cstrong>shock value\u003C/strong>. These videos get high “Watch Time” but very low “True Interest” scores from users.\u003C/li>\n\u003Cli>\u003Cstrong>The Logic:\u003C/strong> Because the UTIS model demotes content that has high engagement but low survey satisfaction, it naturally “starves” clickbait and sensationalist content of distribution. When you stop optimizing for “eyes on screen” and start optimizing for “value in mind,” the system naturally filters out a significant portion of harmful content without needing a separate censorship layer.\u003C/li>\n\u003C/ul>\n\u003Cblockquote>\n\u003Cp>\u003Cstrong>Key Takeaway:\u003C/strong> Better matching isn’t just about fun; it’s about \u003Cstrong>safety and sustainability\u003C/strong>. When your AI understands what a user \u003Cem>values\u003C/em>, it stops being tricked by content that is merely \u003Cem>loud\u003C/em>.\u003C/p>\n\u003C/blockquote>\n\u003Ch2 id=\"6-future-directions-llms-and-the-cold-start-problem\">6. Future Directions: LLMs and the “Cold Start” Problem\u003C/h2>\n\u003Cp>The 2026 Meta Engineering report makes it clear: the work isn’t done. While the UTIS model works wonders for active users, the system still faces two major technical hurdles: \u003Cstrong>Data Scarcity\u003C/strong> for new users and the limitation of \u003Cstrong>Semantic Understanding\u003C/strong>.\u003C/p>\n\u003Ch3 id=\"solving-the-cold-start-sparse-engagement-history\">Solving the “Cold Start” (Sparse Engagement History)\u003C/h3>\n\u003Cp>The biggest challenge for any recommendation engine is the “New User.” If someone just joined Facebook or rarely watches Reels, the UTIS model has no “True Interest” survey data to work with.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>The “Andromeda” Approach:\u003C/strong> Meta is moving toward a more holistic cross-platform signal system. If a new user has joined a “Vintage Camera Restoration” group on Facebook, the Reels engine can now proactively “seed” their feed with related niche content, even before they’ve watched a single video.\u003C/li>\n\u003Cli>\u003Cstrong>User-Led Control:\u003C/strong> In early 2026, Meta rolled out “Your Algorithm” controls, allowing users to manually select and “pin” top topics (like #Snowboarding or #Meditation). This provides an immediate \u003Cstrong>explicit signal\u003C/strong> that bypasses the need for weeks of behavioral data.\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"llms-understanding-the-vibe\">LLMs: Understanding the “Vibe”\u003C/h3>\n\u003Cp>Current models are great at recognizing objects (e.g., “This video has a cat”), but they struggle with \u003Cstrong>abstract nuances\u003C/strong> like mood, humor, or production quality.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Beyond Hashtags:\u003C/strong> Meta is testing \u003Cstrong>Large Language Models (LLMs)\u003C/strong> to “watch” and describe videos in plain English. Instead of a video being tagged as \u003Ccode>#Cooking\u003C/code>, an LLM can identify it as a \u003Cem>“calm, lo-fi ASMR baking video with a nostalgic 1970s aesthetic.”\u003C/em>\u003C/li>\n\u003Cli>\u003Cstrong>The Technical Challenge:\u003C/strong> For 15+ year engineers, the hurdle here is \u003Cstrong>Inference Latency\u003C/strong>. Running a massive LLM for every video in the retrieval pool is computationally impossible. Meta’s future strategy involves using LLMs to generate “Semantic Embeddings”—dense math vectors that capture the “vibe”—which are then stored and used by the faster ranking models.\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"knowledge-distillation-20\">Knowledge Distillation 2.0\u003C/h3>\n\u003Cp>Meta is doubling down on \u003Cstrong>Knowledge Distillation\u003C/strong> to keep the system fast.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>The “Teacher” becomes the “GenAI”:\u003C/strong> In the future, the “Teacher” model won’t just be based on survey results; it will be a multimodal AI that understands text, audio, and video context.\u003C/li>\n\u003Cli>\u003Cstrong>The “Student” (Retrieval):\u003C/strong> The student model will be trained to find videos that match a user’s \u003Cstrong>Current Intent\u003C/strong> (e.g., “I want to learn something”) vs. their \u003Cstrong>General Interest\u003C/strong> (e.g., “I like comedy”).\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"the-ultimate-goal-diversity-over-viralism\">The Ultimate Goal: Diversity over Viralism\u003C/h3>\n\u003Cp>The roadmap for late 2026 focuses on \u003Cstrong>Content Diversity\u003C/strong>. Meta’s research shows that even if you love one topic, seeing too much of it leads to “Content Fatigue.” The next iteration of the UTIS framework will include a \u003Cstrong>“Novelty Penalty”\u003C/strong>—intentionally injecting high-quality, niche content from \u003Cem>unrelated\u003C/em> fields to see if it sparks a new “True Interest.”\u003C/p>\n\u003Cblockquote>\n\u003Cp>\u003Cstrong>Key Takeaway:\u003C/strong> The future of AI at Meta isn’t just about predicting the next click; it’s about \u003Cstrong>anticipating human evolution\u003C/strong>. By combining user-led controls with Generative AI’s ability to understand “mood,” Meta is building a feed that feels less like a machine and more like a personal curator.\u003C/p>\n\u003C/blockquote>\n\u003Ch2 id=\"conclusion-the-new-standard-for-social-discovery\">Conclusion: The New Standard for Social Discovery\u003C/h2>\n\u003Cp>The shift from passive engagement to the \u003Cstrong>User True Interest Survey (UTIS)\u003C/strong> model marks the end of an era for Facebook Reels. For years, the industry was locked in a “Watch Time War,” where success was measured by how long we could keep eyes on a screen. Meta’s 2026 update proves that the next frontier is \u003Cstrong>Value-Based Recommendation.\u003C/strong>\u003C/p>\n\u003Cp>By integrating the Perception Layer across the entire funnel—from the split-second retrieval stage to the final value ranking—Meta has built a system that finally respects the “Human in the Loop.”\u003C/p>\n\u003Ch3 id=\"executive-summary-the-technical-tldr\">Executive Summary: The Technical “TL;DR”\u003C/h3>\n\u003Cdiv style=\"overflow-x:auto; font-family: &#x27;Segoe UI&#x27;, Tahoma, Geneva, Verdana, sans-serif;\">\n  \u003Ctable style=\"border-collapse: collapse; width: 100%; box-shadow: 0 4px 8px rgba(0,0,0,0.1); border-radius: 8px; overflow: hidden;\">\n    \u003Cthead>\n      \u003Ctr style=\"background-color: #2c3e50; color: white; text-align: left;\">\n        \u003Cth style=\"padding: 15px; border-bottom: 2px solid #1a252f;\">Feature\u003C/th>\n        \u003Cth style=\"padding: 15px; border-bottom: 2px solid #1a252f;\">Old System (Heuristic-Based)\u003C/th>\n        \u003Cth style=\"padding: 15px; border-bottom: 2px solid #1a252f;\">New System (UTIS Model)\u003C/th>\n      \u003C/tr>\n    \u003C/thead>\n    \u003Ctbody style=\"background-color: #ffffff; color: #333;\">\n      \u003Ctr style=\"border-bottom: 1px solid #eee;\">\n        \u003Ctd style=\"padding: 12px 15px; font-weight: 600; background-color: #f8f9fa;\">Primary Signal\u003C/td>\n        \u003Ctd style=\"padding: 12px 15px;\">Implicit (Watch time, Likes)\u003C/td>\n        \u003Ctd style=\"padding: 12px 15px;\">Explicit (Survey-verified Interest)\u003C/td>\n      \u003C/tr>\n      \u003Ctr style=\"border-bottom: 1px solid #eee; background-color: #fdfdfd;\">\n        \u003Ctd style=\"padding: 12px 15px; font-weight: 600; background-color: #f8f9fa;\">Accuracy\u003C/td>\n        \u003Ctd style=\"padding: 12px 15px; color: #e67e22;\">48.3% Precision\u003C/td>\n        \u003Ctd style=\"padding: 12px 15px; color: #27ae60; font-weight: bold;\">71.5% Accuracy\u003C/td>\n      \u003C/tr>\n      \u003Ctr style=\"border-bottom: 1px solid #eee;\">\n        \u003Ctd style=\"padding: 12px 15px; font-weight: 600; background-color: #f8f9fa;\">Funnel Strategy\u003C/td>\n        \u003Ctd style=\"padding: 12px 15px;\">Late-stage filtering only\u003C/td>\n        \u003Ctd style=\"padding: 12px 15px;\">Deep integration via Knowledge Distillation\u003C/td>\n      \u003C/tr>\n      \u003Ctr style=\"border-bottom: 1px solid #eee; background-color: #fdfdfd;\">\n        \u003Ctd style=\"padding: 12px 15px; font-weight: 600; background-color: #f8f9fa;\">User Impact\u003C/td>\n        \u003Ctd style=\"padding: 12px 15px;\">”Pop” viral content dominant\u003C/td>\n        \u003Ctd style=\"padding: 12px 15px;\">High-quality, Niche content boost\u003C/td>\n      \u003C/tr>\n      \u003Ctr>\n        \u003Ctd style=\"padding: 12px 15px; font-weight: 600; background-color: #f8f9fa;\">Ecosystem\u003C/td>\n        \u003Ctd style=\"padding: 12px 15px;\">Optimized for Attention\u003C/td>\n        \u003Ctd style=\"padding: 12px 15px; font-weight: bold; color: #2980b9;\">Optimized for Long-term Utility\u003C/td>\n      \u003C/tr>\n    \u003C/tbody>\n  \u003C/table>\n\u003C/div>\n\u003Ch3 id=\"key-insights-for-the-engineering-community\">Key Insights for the Engineering Community\u003C/h3>\n\u003Cul>\n\u003Cli>\u003Cstrong>1-2 Year Engineers:\u003C/strong> Focus on the importance of \u003Cstrong>Ground Truth\u003C/strong>. No matter how complex your neural network is, it is only as good as the data labels you feed it. Moving from “guessing” (heuristics) to “asking” (surveys) is often more impactful than adding a billion parameters.\u003C/li>\n\u003Cli>\u003Cstrong>Senior Architects (15+ Years):\u003C/strong> The real innovation here is \u003Cstrong>Alignment.\u003C/strong> By using the smart LSR model to “teach” the retrieval models through \u003Cstrong>Knowledge Distillation\u003C/strong>, Meta solved the latency-vs-intelligence trade-off. This allows high-level human perception to influence low-level, high-speed candidate sourcing.\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"final-thought\">Final Thought\u003C/h3>\n\u003Cp>As we move further into 2026, the definition of a “good” algorithm is changing. It’s no longer just about predicting the next click; it’s about understanding the \u003Cstrong>intent, mood, and motivation\u003C/strong> behind the human using the device. The UTIS model is a significant step toward an AI that doesn’t just watch us, but actually understands us.\u003C/p>",{"headings":32,"localImagePaths":152,"remoteImagePaths":153,"frontmatter":154,"imagePaths":157},[33,37,41,44,47,50,53,57,60,62,65,68,71,74,77,80,83,86,89,92,95,98,101,104,107,110,113,116,119,122,125,128,131,134,137,140,143,146,149],{"depth":34,"slug":35,"text":36},1,"high-level-overview","High Level Overview",{"depth":38,"slug":39,"text":40},2,"1-beyond-the-click-why-watch-time-isnt-enough","1. Beyond the “Click”: Why Watch Time Isn’t Enough",{"depth":38,"slug":42,"text":43},"2-the-utis-model-real-time-listening-at-scale","2. The UTIS Model: Real-Time Listening at Scale",{"depth":38,"slug":45,"text":46},"3-the-perception-layer-generalizing-sparse-feedback","3. The “Perception Layer”: Generalizing Sparse Feedback",{"depth":38,"slug":48,"text":49},"4-re-engineering-the-funnel-lsr--knowledge-distillation","4. Re-Engineering the Funnel: LSR & Knowledge Distillation",{"depth":38,"slug":51,"text":52},"5-proven-results-the-10-million-user-test","5. Proven Results: The 10-Million User Test",{"depth":54,"slug":55,"text":56},3,"key-performance-metrics","Key Performance Metrics",{"depth":38,"slug":58,"text":59},"6-the-2026-horizon-data-sparsity--llms","6. The 2026 Horizon: Data Sparsity & LLMs",{"depth":38,"slug":61,"text":40},"1-beyond-the-click-why-watch-time-isnt-enough-1",{"depth":54,"slug":63,"text":64},"the-problem-the-passive-signal-trap","The Problem: The “Passive Signal” Trap",{"depth":54,"slug":66,"text":67},"the-complexity-of-true-interest","The Complexity of “True Interest”",{"depth":54,"slug":69,"text":70},"the-technical-pivot-from-heuristics-to-perception","The Technical Pivot: From “Heuristics” to “Perception”",{"depth":38,"slug":72,"text":73},"2-data-collection-measuring-user-perception","2. Data Collection: Measuring User Perception",{"depth":54,"slug":75,"text":76},"the-mechanism-in-context-micro-surveys","The Mechanism: In-Context Micro-Surveys",{"depth":54,"slug":78,"text":79},"the-sampling-bias-challenge","The “Sampling Bias” Challenge",{"depth":54,"slug":81,"text":82},"the-engineering-solution-statistical-weighting","The Engineering Solution: Statistical Weighting",{"depth":54,"slug":84,"text":85},"why-this-matters-for-the-model","Why This Matters for the Model",{"depth":38,"slug":87,"text":88},"3-the-utis-model-architecture-the-perception-layer","3. The UTIS Model Architecture: The Perception Layer",{"depth":54,"slug":90,"text":91},"the-architecture-a-lightweight-alignment-layer","The Architecture: A Lightweight Alignment Layer",{"depth":54,"slug":93,"text":94},"the-denoising-secret-data-binarization","The Denoising Secret: Data Binarization",{"depth":54,"slug":96,"text":97},"interpretable-design","Interpretable Design",{"depth":38,"slug":99,"text":100},"4-system-integration-how-utis-reshapes-the-funnel","4. System Integration: How UTIS Reshapes the Funnel",{"depth":54,"slug":102,"text":103},"late-stage-ranking-lsr-the-final-quality-control","Late Stage Ranking (LSR): The Final Quality Control",{"depth":54,"slug":105,"text":106},"early-stage-ranking-retrieval-finding-the-niche","Early Stage Ranking (Retrieval): Finding the Niche",{"depth":54,"slug":108,"text":109},"key-engineering-concepts","Key Engineering Concepts",{"depth":54,"slug":111,"text":112},"the-ecosystem-shift","The Ecosystem Shift",{"depth":38,"slug":114,"text":115},"5-performance-results-the-impact-of-listening","5. Performance Results: The Impact of “Listening”",{"depth":54,"slug":117,"text":118},"the-hard-metrics-proving-quality-drives-engagement","The “Hard” Metrics: Proving Quality Drives Engagement",{"depth":54,"slug":120,"text":121},"the-sentiment-metrics-closing-the-satisfaction-gap","The “Sentiment” Metrics: Closing the Satisfaction Gap",{"depth":54,"slug":123,"text":124},"the-surprise-win--034-integrity-violations","The Surprise Win: -0.34% Integrity Violations",{"depth":38,"slug":126,"text":127},"6-future-directions-llms-and-the-cold-start-problem","6. Future Directions: LLMs and the “Cold Start” Problem",{"depth":54,"slug":129,"text":130},"solving-the-cold-start-sparse-engagement-history","Solving the “Cold Start” (Sparse Engagement History)",{"depth":54,"slug":132,"text":133},"llms-understanding-the-vibe","LLMs: Understanding the “Vibe”",{"depth":54,"slug":135,"text":136},"knowledge-distillation-20","Knowledge Distillation 2.0",{"depth":54,"slug":138,"text":139},"the-ultimate-goal-diversity-over-viralism","The Ultimate Goal: Diversity over Viralism",{"depth":38,"slug":141,"text":142},"conclusion-the-new-standard-for-social-discovery","Conclusion: The New Standard for Social Discovery",{"depth":54,"slug":144,"text":145},"executive-summary-the-technical-tldr","Executive Summary: The Technical “TL;DR”",{"depth":54,"slug":147,"text":148},"key-insights-for-the-engineering-community","Key Insights for the Engineering Community",{"depth":54,"slug":150,"text":151},"final-thought","Final Thought",[],[],{"title":14,"description":15,"pubDate":155,"author":17,"tags":156,"featured":25},"2026-01-17",[19,20,21,22,23,24],[],"fb-utis-engagement.md","rag-basics",{"id":159,"data":161,"body":169,"filePath":170,"digest":171,"rendered":172,"legacyId":203},{"title":162,"description":163,"pubDate":164,"author":17,"tags":165,"featured":25},"Understanding Retrieval-Augmented Generation (RAG)","A deep dive into RAG architecture, one of the most powerful techniques for enhancing LLM responses with external knowledge.",["Date","2024-02-20T00:00:00.000Z"],[24,166,167,168],"LLM","RAG","Machine Learning","## What is RAG?\n\nRetrieval-Augmented Generation (RAG) is a powerful technique that enhances Large Language Models (LLMs) by combining two key components:\n\n1. **Retrieval**: Fetching relevant information from external knowledge bases\n2. **Augmented Generation**: Using that information to generate more accurate responses\n\n## Why RAG?\n\nLLMs like GPT-4 have knowledge cutoffs and can hallucinate. RAG solves this by:\n\n- grounding responses in real, up-to-date information\n- reducing hallucinations by providing source context\n- allowing models to cite their sources\n- enabling updates without retraining\n\n## RAG Architecture\n\n### 1. Document Processing Pipeline\n\n```\nRaw Documents → Chunking → Embedding → Vector Store\n```\n\n### 2. Retrieval Process\n\n```\nUser Query → Query Embedding → Similarity Search → Top-K Results\n```\n\n### 3. Generation Phase\n\n```\nPrompt + Retrieved Context → LLM → Final Response\n```\n\n## Conclusion\n\nRAG represents a significant advancement in making LLMs more reliable and useful for real-world applications. By combining retrieval and generation, we can build systems that are both powerful and trustworthy.","src/content/blog/rag-basics.md","1d5727299773156d",{"html":173,"metadata":174},"\u003Ch2 id=\"what-is-rag\">What is RAG?\u003C/h2>\n\u003Cp>Retrieval-Augmented Generation (RAG) is a powerful technique that enhances Large Language Models (LLMs) by combining two key components:\u003C/p>\n\u003Col>\n\u003Cli>\u003Cstrong>Retrieval\u003C/strong>: Fetching relevant information from external knowledge bases\u003C/li>\n\u003Cli>\u003Cstrong>Augmented Generation\u003C/strong>: Using that information to generate more accurate responses\u003C/li>\n\u003C/ol>\n\u003Ch2 id=\"why-rag\">Why RAG?\u003C/h2>\n\u003Cp>LLMs like GPT-4 have knowledge cutoffs and can hallucinate. RAG solves this by:\u003C/p>\n\u003Cul>\n\u003Cli>grounding responses in real, up-to-date information\u003C/li>\n\u003Cli>reducing hallucinations by providing source context\u003C/li>\n\u003Cli>allowing models to cite their sources\u003C/li>\n\u003Cli>enabling updates without retraining\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"rag-architecture\">RAG Architecture\u003C/h2>\n\u003Ch3 id=\"1-document-processing-pipeline\">1. Document Processing Pipeline\u003C/h3>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"plaintext\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan>Raw Documents → Chunking → Embedding → Vector Store\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"2-retrieval-process\">2. Retrieval Process\u003C/h3>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"plaintext\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan>User Query → Query Embedding → Similarity Search → Top-K Results\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"3-generation-phase\">3. Generation Phase\u003C/h3>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"plaintext\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan>Prompt + Retrieved Context → LLM → Final Response\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"conclusion\">Conclusion\u003C/h2>\n\u003Cp>RAG represents a significant advancement in making LLMs more reliable and useful for real-world applications. By combining retrieval and generation, we can build systems that are both powerful and trustworthy.\u003C/p>",{"headings":175,"localImagePaths":197,"remoteImagePaths":198,"frontmatter":199,"imagePaths":202},[176,179,182,185,188,191,194],{"depth":38,"slug":177,"text":178},"what-is-rag","What is RAG?",{"depth":38,"slug":180,"text":181},"why-rag","Why RAG?",{"depth":38,"slug":183,"text":184},"rag-architecture","RAG Architecture",{"depth":54,"slug":186,"text":187},"1-document-processing-pipeline","1. Document Processing Pipeline",{"depth":54,"slug":189,"text":190},"2-retrieval-process","2. Retrieval Process",{"depth":54,"slug":192,"text":193},"3-generation-phase","3. Generation Phase",{"depth":38,"slug":195,"text":196},"conclusion","Conclusion",[],[],{"title":162,"description":163,"pubDate":200,"author":17,"tags":201,"featured":25},"2024-02-20",[24,166,167,168],[],"rag-basics.md","fine-tune-llm",{"id":204,"data":206,"body":214,"filePath":215,"assetImports":216,"digest":221,"rendered":222,"legacyId":271},{"title":207,"description":208,"pubDate":209,"author":17,"tags":210,"featured":25},"Engineering Virality: Fine-Tuning LLMs for Style Transfer using QLoRA and DPO","A deep dive into building a silver-standard dataset and using Direct Preference Optimization (DPO) to eliminate 'AI-isms' and master high-engagement writing.",["Date","2026-01-23T00:00:00.000Z"],[166,211,212,213,19,23],"FineTuning","DPO","QLoRA","For years, social media algorithms have been like silent observers. However, capturing \"True Interest\" requires more than just passive signals; it requires a model that understands the nuance of style and intent. To build a system that replicates high-engagement writing, we must move beyond basic prompting and into the territory of custom fine-tuning.\n\n---\n\n## 1. Data Engineering: The \"Engagement-Weighted\" Corpus\n\nScraping the top 100 posts is a start, but for a production-grade model, we need a **Silver-Standard Dataset** of at least 2,000–5,000 samples to avoid catastrophic forgetting or overfitting.\n\nTo achieve a silver-standard dataset, we implemented a multi-stage refinement pipeline (see Figure 1). This ensures that the raw noise of the web is distilled into high-signal training data.\n\n![Data Engineering Flow](../../assets/images/Flow.png)\n\n\n### The Pipeline:\n1. **Scraping & Metadata Extraction:** Use `playwright` to capture text alongside **Engagement Velocity** and **Follower-to-Engagement ratio**.\n2. **Denoising with LLMs:** Use a smaller model like **Phi-3** to perform **Semantic Cleaning**.\n3. **Reverse Instruction Seed (RIS):** Use a teacher model (Claude 3.5 Sonnet) to infer the \"Latent Intent\" (the prompt) behind viral posts.\n\n---\n\n## 2. Modeling: QLoRA with High-Rank Adapters\n\nSince we are teaching *style* rather than *facts*, we focus on the **Attention Blocks** and **MLP Layers** using QLoRA.\n\n* **Precision:** 4-bit NormalFloat (NF4).\n* **Rank ($r$):** 64. (Necessary for nuanced style; $r=8$ is too \"stiff\").\n* **Alpha ($\\alpha$):** 128.\n* **Target Modules:** `q_proj`, `k_proj`, `v_proj`, `o_proj`, `gate_proj`, `up_proj`, `down_proj`.\n\n![QLoRA Adapter Injection](../../assets/images/QLoRA.png)\n\n---\n\n## 3. Alignment: DPO (Direct Preference Optimization)\n\nSFT teaches the model *how* to write. **DPO** teaches it *what we prefer*. This is where you eliminate \"AI-isms\" like *\"In the ever-evolving landscape...\"*\n\nThe goal is to move the policy $\\pi_{\\theta}$ toward the \"high-engagement\" distribution using the DPO loss:\n\n$$L_{DPO}(\\pi_{\\theta}; \\pi_{ref}) = -\\mathbb{E}_{(x, y_w, y_l) \\sim D} \\left[ \\log \\sigma \\left( \\beta \\log \\frac{\\pi_{\\theta}(y_w|x)}{\\pi_{ref}(y_w|x)} - \\beta \\log \\frac{\\pi_{\\theta}(y_l|x)}{\\pi_{ref}(y_l|x)} \\right) \\right]$$\n\n### The Negative Sample Generator\nYou need **synthetic negative samples**. Take your \"Top 100\" Gold Set ($y_w$) and have an LLM rewrite them to sound like boring corporate press releases ($y_l$). This creates the gradient between high-engagement and noise.\n\n---\n\n## 4. Implementation (PyTorch + TRL)\n\nAssuming you are using **QLoRA** for parameter efficiency, here is the DPO training setup:\n\n```python\nfrom trl import DPOTrainer, DPOConfig\nfrom peft import LoraConfig\n\npeft_config = LoraConfig(\n    r=64, \n    lora_alpha=128,\n    target_modules=[\"q_proj\", \"v_proj\", \"k_proj\", \"o_proj\", \"gate_proj\", \"up_proj\", \"down_proj\"],\n    task_type=\"CAUSAL_LM\",\n)\n\ndpo_trainer = DPOTrainer(\n    model,\n    ref_model,\n    args=DPOConfig(\n        beta=0.1, \n        output_dir=\"./linkedin-dpo-v1\", \n        learning_rate=5e-5,\n        lr_scheduler_type=\"cosine\",\n        max_length=1024\n    ),\n    train_dataset=dataset[\"train\"],\n    tokenizer=tokenizer,\n    peft_config=peft_config,\n)\n\ndpo_trainer.train()\n\n```\n\n---\n\n## 5. Evaluation: Beyond Perplexity\n\nStandard metrics like BLEU or ROUGE fail for style transfer because viral writing is often non-grammatical and structurally unique. Instead, we implement a **Custom Evaluation Suite**:\n\n![Post Training Evaluation](../../assets/images/Evaluation.png)\n\n### A. LLM-as-a-Judge (The Rubric)\nWe use GPT-4o as a proxy evaluator with a specific 5-point rubric:\n1. **Hook Efficacy:** Is the first sentence \u003C 10 words and provocative?\n2. **Formatting (The Bento):** Are there clear line breaks and bullet points?\n3. **No-Fluff Index:** Is the \"pulp\" (useless adjectives) minimized?\n\n![LLM-as-a-Judge Performance](../../assets/images/LLM-Judge.png)\n\n### B. Embedding Drift (Cosine Similarity)\nWe compare the embeddings of the model’s output against the embeddings of our \"Gold Set\" (the top 100 viral posts) using `text-embedding-3-small`. You want a similarity score $cos(\\theta) > 0.85$ while maintaining high diversity.\n\n### C. Structural Entropy\nViral posts have high **structural entropy** (short lines followed by long lists). Generic AI has low entropy (uniform paragraph lengths). We target a $20\\%$ increase in line-length variance compared to the base model.\n\n---\n\n## 6. Advanced Monitoring: Reward Margin\n\nDuring the DPO phase, it is critical to monitor the **log-probability margin** to ensure the model is actually learning the preference surface:\n\n$$\\text{Margin} = \\log \\frac{\\pi_{\\theta}(y_{w}|x)}{\\pi_{ref}(y_{w}|x)} - \\log \\frac{\\pi_{\\theta}(y_{l}|x)}{\\pi_{ref}(y_{l}|x)}$$\n\nIf this margin increases while **KL Divergence** stays under $0.2$, the model is successfully shifting its \"vibe\" without collapsing into repetitive or nonsensical text.\n\n---\n\n## 7. The \"See More\" Proxy\n\nThe most technical metric in this pipeline is the \"See More\" classifier. We use a BERT-based model trained on our scraped data to predict the **probability of a user clicking \"See More\"** based purely on the text structure and the strength of the hook.\n\nBy aligning our loss function with these behavioral proxies, we move beyond simple text generation and into the realm of **algorithmic engineering**.\n\n---\n\n## 8. Conclusion\n\nFine-tuning for style is significantly more difficult than fine-tuning for facts. It requires a clean gradient between \"corporate noise\" and \"high-engagement prose.\" By combining **QLoRA** for efficiency and **DPO** for alignment, we can create models that don't just speak—they resonate.\n\n**What's next?** I am currently experimenting with **ORPO (Odds Ratio Preference Optimization)** to see if we can achieve similar results in a single training step. Stay tuned for the benchmarks.","src/content/blog/fine-tune-llm.md",[217,218,219,220],"../../assets/images/Flow.png","../../assets/images/QLoRA.png","../../assets/images/Evaluation.png","../../assets/images/LLM-Judge.png","94b292e2254a695e",{"html":223,"metadata":224},"\u003Cp>For years, social media algorithms have been like silent observers. However, capturing “True Interest” requires more than just passive signals; it requires a model that understands the nuance of style and intent. To build a system that replicates high-engagement writing, we must move beyond basic prompting and into the territory of custom fine-tuning.\u003C/p>\n\u003Chr>\n\u003Ch2 id=\"1-data-engineering-the-engagement-weighted-corpus\">1. Data Engineering: The “Engagement-Weighted” Corpus\u003C/h2>\n\u003Cp>Scraping the top 100 posts is a start, but for a production-grade model, we need a \u003Cstrong>Silver-Standard Dataset\u003C/strong> of at least 2,000–5,000 samples to avoid catastrophic forgetting or overfitting.\u003C/p>\n\u003Cp>To achieve a silver-standard dataset, we implemented a multi-stage refinement pipeline (see Figure 1). This ensures that the raw noise of the web is distilled into high-signal training data.\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../assets/images/Flow.png&#x22;,&#x22;alt&#x22;:&#x22;Data Engineering Flow&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Ch3 id=\"the-pipeline\">The Pipeline:\u003C/h3>\n\u003Col>\n\u003Cli>\u003Cstrong>Scraping &#x26; Metadata Extraction:\u003C/strong> Use \u003Ccode>playwright\u003C/code> to capture text alongside \u003Cstrong>Engagement Velocity\u003C/strong> and \u003Cstrong>Follower-to-Engagement ratio\u003C/strong>.\u003C/li>\n\u003Cli>\u003Cstrong>Denoising with LLMs:\u003C/strong> Use a smaller model like \u003Cstrong>Phi-3\u003C/strong> to perform \u003Cstrong>Semantic Cleaning\u003C/strong>.\u003C/li>\n\u003Cli>\u003Cstrong>Reverse Instruction Seed (RIS):\u003C/strong> Use a teacher model (Claude 3.5 Sonnet) to infer the “Latent Intent” (the prompt) behind viral posts.\u003C/li>\n\u003C/ol>\n\u003Chr>\n\u003Ch2 id=\"2-modeling-qlora-with-high-rank-adapters\">2. Modeling: QLoRA with High-Rank Adapters\u003C/h2>\n\u003Cp>Since we are teaching \u003Cem>style\u003C/em> rather than \u003Cem>facts\u003C/em>, we focus on the \u003Cstrong>Attention Blocks\u003C/strong> and \u003Cstrong>MLP Layers\u003C/strong> using QLoRA.\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Precision:\u003C/strong> 4-bit NormalFloat (NF4).\u003C/li>\n\u003Cli>\u003Cstrong>Rank (\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>r\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">r\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.4306em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r\u003C/span>\u003C/span>\u003C/span>\u003C/span>):\u003C/strong> 64. (Necessary for nuanced style; \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>r\u003C/mi>\u003Cmo>=\u003C/mo>\u003Cmn>8\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">r=8\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.4306em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6444em;\">\u003C/span>\u003Cspan class=\"mord\">8\u003C/span>\u003C/span>\u003C/span>\u003C/span> is too “stiff”).\u003C/li>\n\u003Cli>\u003Cstrong>Alpha (\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>α\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\alpha\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.4306em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α\u003C/span>\u003C/span>\u003C/span>\u003C/span>):\u003C/strong> 128.\u003C/li>\n\u003Cli>\u003Cstrong>Target Modules:\u003C/strong> \u003Ccode>q_proj\u003C/code>, \u003Ccode>k_proj\u003C/code>, \u003Ccode>v_proj\u003C/code>, \u003Ccode>o_proj\u003C/code>, \u003Ccode>gate_proj\u003C/code>, \u003Ccode>up_proj\u003C/code>, \u003Ccode>down_proj\u003C/code>.\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../assets/images/QLoRA.png&#x22;,&#x22;alt&#x22;:&#x22;QLoRA Adapter Injection&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Chr>\n\u003Ch2 id=\"3-alignment-dpo-direct-preference-optimization\">3. Alignment: DPO (Direct Preference Optimization)\u003C/h2>\n\u003Cp>SFT teaches the model \u003Cem>how\u003C/em> to write. \u003Cstrong>DPO\u003C/strong> teaches it \u003Cem>what we prefer\u003C/em>. This is where you eliminate “AI-isms” like \u003Cem>“In the ever-evolving landscape…”\u003C/em>\u003C/p>\n\u003Cp>The goal is to move the policy \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>π\u003C/mi>\u003Cmi>θ\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\pi_{\\theta}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">θ\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span> toward the “high-engagement” distribution using the DPO loss:\u003C/p>\n\u003Cp>\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>L\u003C/mi>\u003Cmrow>\u003Cmi>D\u003C/mi>\u003Cmi>P\u003C/mi>\u003Cmi>O\u003C/mi>\u003C/mrow>\u003C/msub>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmsub>\u003Cmi>π\u003C/mi>\u003Cmi>θ\u003C/mi>\u003C/msub>\u003Cmo separator=\"true\">;\u003C/mo>\u003Cmsub>\u003Cmi>π\u003C/mi>\u003Cmrow>\u003Cmi>r\u003C/mi>\u003Cmi>e\u003C/mi>\u003Cmi>f\u003C/mi>\u003C/mrow>\u003C/msub>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmo>=\u003C/mo>\u003Cmo>−\u003C/mo>\u003Cmsub>\u003Cmi mathvariant=\"double-struck\">E\u003C/mi>\u003Cmrow>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>x\u003C/mi>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmsub>\u003Cmi>y\u003C/mi>\u003Cmi>w\u003C/mi>\u003C/msub>\u003Cmo separator=\"true\">,\u003C/mo>\u003Cmsub>\u003Cmi>y\u003C/mi>\u003Cmi>l\u003C/mi>\u003C/msub>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmo>∼\u003C/mo>\u003Cmi>D\u003C/mi>\u003C/mrow>\u003C/msub>\u003Cmrow>\u003Cmo fence=\"true\">[\u003C/mo>\u003Cmi>log\u003C/mi>\u003Cmo>⁡\u003C/mo>\u003Cmi>σ\u003C/mi>\u003Cmrow>\u003Cmo fence=\"true\">(\u003C/mo>\u003Cmi>β\u003C/mi>\u003Cmi>log\u003C/mi>\u003Cmo>⁡\u003C/mo>\u003Cmfrac>\u003Cmrow>\u003Cmsub>\u003Cmi>π\u003C/mi>\u003Cmi>θ\u003C/mi>\u003C/msub>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmsub>\u003Cmi>y\u003C/mi>\u003Cmi>w\u003C/mi>\u003C/msub>\u003Cmi mathvariant=\"normal\">∣\u003C/mi>\u003Cmi>x\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cmrow>\u003Cmsub>\u003Cmi>π\u003C/mi>\u003Cmrow>\u003Cmi>r\u003C/mi>\u003Cmi>e\u003C/mi>\u003Cmi>f\u003C/mi>\u003C/mrow>\u003C/msub>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmsub>\u003Cmi>y\u003C/mi>\u003Cmi>w\u003C/mi>\u003C/msub>\u003Cmi mathvariant=\"normal\">∣\u003C/mi>\u003Cmi>x\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003C/mfrac>\u003Cmo>−\u003C/mo>\u003Cmi>β\u003C/mi>\u003Cmi>log\u003C/mi>\u003Cmo>⁡\u003C/mo>\u003Cmfrac>\u003Cmrow>\u003Cmsub>\u003Cmi>π\u003C/mi>\u003Cmi>θ\u003C/mi>\u003C/msub>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmsub>\u003Cmi>y\u003C/mi>\u003Cmi>l\u003C/mi>\u003C/msub>\u003Cmi mathvariant=\"normal\">∣\u003C/mi>\u003Cmi>x\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cmrow>\u003Cmsub>\u003Cmi>π\u003C/mi>\u003Cmrow>\u003Cmi>r\u003C/mi>\u003Cmi>e\u003C/mi>\u003Cmi>f\u003C/mi>\u003C/mrow>\u003C/msub>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmsub>\u003Cmi>y\u003C/mi>\u003Cmi>l\u003C/mi>\u003C/msub>\u003Cmi mathvariant=\"normal\">∣\u003C/mi>\u003Cmi>x\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003C/mfrac>\u003Cmo fence=\"true\">)\u003C/mo>\u003C/mrow>\u003Cmo fence=\"true\">]\u003C/mo>\u003C/mrow>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">L_{DPO}(\\pi_{\\theta}; \\pi_{ref}) = -\\mathbb{E}_{(x, y_w, y_l) \\sim D} \\left[ \\log \\sigma \\left( \\beta \\log \\frac{\\pi_{\\theta}(y_w|x)}{\\pi_{ref}(y_w|x)} - \\beta \\log \\frac{\\pi_{\\theta}(y_l|x)}{\\pi_{ref}(y_l|x)} \\right) \\right]\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\">L\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3283em;\">\u003Cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">D\u003C/span>\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">PO\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">θ\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mpunct\">;\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\">re\u003C/span>\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2861em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.8em;vertical-align:-0.65em;\">\u003C/span>\u003Cspan class=\"mord\">−\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathbb\">E\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3448em;\">\u003Cspan style=\"top:-2.5198em;margin-left:0em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mopen mtight\">(\u003C/span>\u003Cspan class=\"mord mathnormal mtight\">x\u003C/span>\u003Cspan class=\"mpunct mtight\">,\u003C/span>\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.1645em;\">\u003Cspan style=\"top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;\">\u003Cspan class=\"pstrut\" style=\"height:2.5em;\">\u003C/span>\u003Cspan class=\"sizing reset-size3 size1 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.02691em;\">w\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.143em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mpunct mtight\">,\u003C/span>\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3448em;\">\u003Cspan style=\"top:-2.3488em;margin-left:-0.0359em;margin-right:0.0714em;\">\u003Cspan class=\"pstrut\" style=\"height:2.5em;\">\u003C/span>\u003Cspan class=\"sizing reset-size3 size1 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.1512em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose mtight\">)\u003C/span>\u003Cspan class=\"mrel mtight\">∼\u003C/span>\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">D\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3552em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"minner\">\u003Cspan class=\"mopen delimcenter\" style=\"top:0em;\">\u003Cspan class=\"delimsizing size2\">[\u003C/span>\u003C/span>\u003Cspan class=\"mop\">lo\u003Cspan style=\"margin-right:0.01389em;\">g\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">σ\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"minner\">\u003Cspan class=\"mopen delimcenter\" style=\"top:0em;\">\u003Cspan class=\"delimsizing size2\">(\u003C/span>\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mop\">lo\u003Cspan style=\"margin-right:0.01389em;\">g\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mopen nulldelimiter\">\u003C/span>\u003Cspan class=\"mfrac\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:1.01em;\">\u003Cspan style=\"top:-2.655em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">π\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3448em;\">\u003Cspan style=\"top:-2.3488em;margin-left:-0.0359em;margin-right:0.0714em;\">\u003Cspan class=\"pstrut\" style=\"height:2.5em;\">\u003C/span>\u003Cspan class=\"sizing reset-size3 size1 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\">re\u003C/span>\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2901em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mopen mtight\">(\u003C/span>\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.1645em;\">\u003Cspan style=\"top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;\">\u003Cspan class=\"pstrut\" style=\"height:2.5em;\">\u003C/span>\u003Cspan class=\"sizing reset-size3 size1 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.02691em;\">w\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.143em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord mtight\">∣\u003C/span>\u003Cspan class=\"mord mathnormal mtight\">x\u003C/span>\u003Cspan class=\"mclose mtight\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.23em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"frac-line\" style=\"border-bottom-width:0.04em;\">\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.485em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">π\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3448em;\">\u003Cspan style=\"top:-2.3488em;margin-left:-0.0359em;margin-right:0.0714em;\">\u003Cspan class=\"pstrut\" style=\"height:2.5em;\">\u003C/span>\u003Cspan class=\"sizing reset-size3 size1 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">θ\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.1512em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mopen mtight\">(\u003C/span>\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.1645em;\">\u003Cspan style=\"top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;\">\u003Cspan class=\"pstrut\" style=\"height:2.5em;\">\u003C/span>\u003Cspan class=\"sizing reset-size3 size1 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.02691em;\">w\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.143em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord mtight\">∣\u003C/span>\u003Cspan class=\"mord mathnormal mtight\">x\u003C/span>\u003Cspan class=\"mclose mtight\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.5481em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose nulldelimiter\">\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">−\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mop\">lo\u003Cspan style=\"margin-right:0.01389em;\">g\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mopen nulldelimiter\">\u003C/span>\u003Cspan class=\"mfrac\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:1.01em;\">\u003Cspan style=\"top:-2.655em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">π\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3448em;\">\u003Cspan style=\"top:-2.3488em;margin-left:-0.0359em;margin-right:0.0714em;\">\u003Cspan class=\"pstrut\" style=\"height:2.5em;\">\u003C/span>\u003Cspan class=\"sizing reset-size3 size1 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\">re\u003C/span>\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2901em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mopen mtight\">(\u003C/span>\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3448em;\">\u003Cspan style=\"top:-2.3488em;margin-left:-0.0359em;margin-right:0.0714em;\">\u003Cspan class=\"pstrut\" style=\"height:2.5em;\">\u003C/span>\u003Cspan class=\"sizing reset-size3 size1 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.1512em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord mtight\">∣\u003C/span>\u003Cspan class=\"mord mathnormal mtight\">x\u003C/span>\u003Cspan class=\"mclose mtight\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.23em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"frac-line\" style=\"border-bottom-width:0.04em;\">\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.485em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">π\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3448em;\">\u003Cspan style=\"top:-2.3488em;margin-left:-0.0359em;margin-right:0.0714em;\">\u003Cspan class=\"pstrut\" style=\"height:2.5em;\">\u003C/span>\u003Cspan class=\"sizing reset-size3 size1 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">θ\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.1512em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mopen mtight\">(\u003C/span>\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3448em;\">\u003Cspan style=\"top:-2.3488em;margin-left:-0.0359em;margin-right:0.0714em;\">\u003Cspan class=\"pstrut\" style=\"height:2.5em;\">\u003C/span>\u003Cspan class=\"sizing reset-size3 size1 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.1512em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord mtight\">∣\u003C/span>\u003Cspan class=\"mord mathnormal mtight\">x\u003C/span>\u003Cspan class=\"mclose mtight\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.5481em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose nulldelimiter\">\u003C/span>\u003C/span>\u003Cspan class=\"mclose delimcenter\" style=\"top:0em;\">\u003Cspan class=\"delimsizing size2\">)\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose delimcenter\" style=\"top:0em;\">\u003Cspan class=\"delimsizing size2\">]\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/p>\n\u003Ch3 id=\"the-negative-sample-generator\">The Negative Sample Generator\u003C/h3>\n\u003Cp>You need \u003Cstrong>synthetic negative samples\u003C/strong>. Take your “Top 100” Gold Set (\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>y\u003C/mi>\u003Cmi>w\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">y_w\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.1514em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.02691em;\">w\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>) and have an LLM rewrite them to sound like boring corporate press releases (\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmsub>\u003Cmi>y\u003C/mi>\u003Cmi>l\u003C/mi>\u003C/msub>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">y_l\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3361em;\">\u003Cspan style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\">\u003Cspan class=\"pstrut\" style=\"height:2.7em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.15em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>). This creates the gradient between high-engagement and noise.\u003C/p>\n\u003Chr>\n\u003Ch2 id=\"4-implementation-pytorch--trl\">4. Implementation (PyTorch + TRL)\u003C/h2>\n\u003Cp>Assuming you are using \u003Cstrong>QLoRA\u003C/strong> for parameter efficiency, here is the DPO training setup:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">from\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> trl \u003C/span>\u003Cspan style=\"color:#F97583\">import\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> DPOTrainer, DPOConfig\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">from\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> peft \u003C/span>\u003Cspan style=\"color:#F97583\">import\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> LoraConfig\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">peft_config \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> LoraConfig(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">    r\u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\">64\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">    lora_alpha\u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\">128\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">    target_modules\u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\">[\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"q_proj\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"v_proj\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"k_proj\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"o_proj\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"gate_proj\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"up_proj\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"down_proj\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">],\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">    task_type\u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"CAUSAL_LM\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">dpo_trainer \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> DPOTrainer(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    model,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    ref_model,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">    args\u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\">DPOConfig(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">        beta\u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\">0.1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">        output_dir\u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"./linkedin-dpo-v1\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">        learning_rate\u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\">5e-5\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">        lr_scheduler_type\u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"cosine\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">        max_length\u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\">1024\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    ),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">    train_dataset\u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\">dataset[\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"train\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">],\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">    tokenizer\u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\">tokenizer,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">    peft_config\u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\">peft_config,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">dpo_trainer.train()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Chr>\n\u003Ch2 id=\"5-evaluation-beyond-perplexity\">5. Evaluation: Beyond Perplexity\u003C/h2>\n\u003Cp>Standard metrics like BLEU or ROUGE fail for style transfer because viral writing is often non-grammatical and structurally unique. Instead, we implement a \u003Cstrong>Custom Evaluation Suite\u003C/strong>:\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../assets/images/Evaluation.png&#x22;,&#x22;alt&#x22;:&#x22;Post Training Evaluation&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Ch3 id=\"a-llm-as-a-judge-the-rubric\">A. LLM-as-a-Judge (The Rubric)\u003C/h3>\n\u003Cp>We use GPT-4o as a proxy evaluator with a specific 5-point rubric:\u003C/p>\n\u003Col>\n\u003Cli>\u003Cstrong>Hook Efficacy:\u003C/strong> Is the first sentence &#x3C; 10 words and provocative?\u003C/li>\n\u003Cli>\u003Cstrong>Formatting (The Bento):\u003C/strong> Are there clear line breaks and bullet points?\u003C/li>\n\u003Cli>\u003Cstrong>No-Fluff Index:\u003C/strong> Is the “pulp” (useless adjectives) minimized?\u003C/li>\n\u003C/ol>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../assets/images/LLM-Judge.png&#x22;,&#x22;alt&#x22;:&#x22;LLM-as-a-Judge Performance&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Ch3 id=\"b-embedding-drift-cosine-similarity\">B. Embedding Drift (Cosine Similarity)\u003C/h3>\n\u003Cp>We compare the embeddings of the model’s output against the embeddings of our “Gold Set” (the top 100 viral posts) using \u003Ccode>text-embedding-3-small\u003C/code>. You want a similarity score \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmi>c\u003C/mi>\u003Cmi>o\u003C/mi>\u003Cmi>s\u003C/mi>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmi>θ\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003Cmo>>\u003C/mo>\u003Cmn>0.85\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">cos(\\theta) > 0.85\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\">\u003C/span>\u003Cspan class=\"mord mathnormal\">cos\u003C/span>\u003Cspan class=\"mopen\">(\u003C/span>\u003Cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ\u003C/span>\u003Cspan class=\"mclose\">)\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6444em;\">\u003C/span>\u003Cspan class=\"mord\">0.85\u003C/span>\u003C/span>\u003C/span>\u003C/span> while maintaining high diversity.\u003C/p>\n\u003Ch3 id=\"c-structural-entropy\">C. Structural Entropy\u003C/h3>\n\u003Cp>Viral posts have high \u003Cstrong>structural entropy\u003C/strong> (short lines followed by long lists). Generic AI has low entropy (uniform paragraph lengths). We target a \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmn>20\u003C/mn>\u003Cmi mathvariant=\"normal\">%\u003C/mi>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">20\\%\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8056em;vertical-align:-0.0556em;\">\u003C/span>\u003Cspan class=\"mord\">20%\u003C/span>\u003C/span>\u003C/span>\u003C/span> increase in line-length variance compared to the base model.\u003C/p>\n\u003Chr>\n\u003Ch2 id=\"6-advanced-monitoring-reward-margin\">6. Advanced Monitoring: Reward Margin\u003C/h2>\n\u003Cp>During the DPO phase, it is critical to monitor the \u003Cstrong>log-probability margin\u003C/strong> to ensure the model is actually learning the preference surface:\u003C/p>\n\u003Cp>\u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmtext>Margin\u003C/mtext>\u003Cmo>=\u003C/mo>\u003Cmi>log\u003C/mi>\u003Cmo>⁡\u003C/mo>\u003Cmfrac>\u003Cmrow>\u003Cmsub>\u003Cmi>π\u003C/mi>\u003Cmi>θ\u003C/mi>\u003C/msub>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmsub>\u003Cmi>y\u003C/mi>\u003Cmi>w\u003C/mi>\u003C/msub>\u003Cmi mathvariant=\"normal\">∣\u003C/mi>\u003Cmi>x\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cmrow>\u003Cmsub>\u003Cmi>π\u003C/mi>\u003Cmrow>\u003Cmi>r\u003C/mi>\u003Cmi>e\u003C/mi>\u003Cmi>f\u003C/mi>\u003C/mrow>\u003C/msub>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmsub>\u003Cmi>y\u003C/mi>\u003Cmi>w\u003C/mi>\u003C/msub>\u003Cmi mathvariant=\"normal\">∣\u003C/mi>\u003Cmi>x\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003C/mfrac>\u003Cmo>−\u003C/mo>\u003Cmi>log\u003C/mi>\u003Cmo>⁡\u003C/mo>\u003Cmfrac>\u003Cmrow>\u003Cmsub>\u003Cmi>π\u003C/mi>\u003Cmi>θ\u003C/mi>\u003C/msub>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmsub>\u003Cmi>y\u003C/mi>\u003Cmi>l\u003C/mi>\u003C/msub>\u003Cmi mathvariant=\"normal\">∣\u003C/mi>\u003Cmi>x\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003Cmrow>\u003Cmsub>\u003Cmi>π\u003C/mi>\u003Cmrow>\u003Cmi>r\u003C/mi>\u003Cmi>e\u003C/mi>\u003Cmi>f\u003C/mi>\u003C/mrow>\u003C/msub>\u003Cmo stretchy=\"false\">(\u003C/mo>\u003Cmsub>\u003Cmi>y\u003C/mi>\u003Cmi>l\u003C/mi>\u003C/msub>\u003Cmi mathvariant=\"normal\">∣\u003C/mi>\u003Cmi>x\u003C/mi>\u003Cmo stretchy=\"false\">)\u003C/mo>\u003C/mrow>\u003C/mfrac>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">\\text{Margin} = \\log \\frac{\\pi_{\\theta}(y_{w}|x)}{\\pi_{ref}(y_{w}|x)} - \\log \\frac{\\pi_{\\theta}(y_{l}|x)}{\\pi_{ref}(y_{l}|x)}\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\">\u003C/span>\u003Cspan class=\"mord text\">\u003Cspan class=\"mord\">Margin\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003Cspan class=\"mrel\">=\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2778em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.5581em;vertical-align:-0.5481em;\">\u003C/span>\u003Cspan class=\"mop\">lo\u003Cspan style=\"margin-right:0.01389em;\">g\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mopen nulldelimiter\">\u003C/span>\u003Cspan class=\"mfrac\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:1.01em;\">\u003Cspan style=\"top:-2.655em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">π\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3448em;\">\u003Cspan style=\"top:-2.3488em;margin-left:-0.0359em;margin-right:0.0714em;\">\u003Cspan class=\"pstrut\" style=\"height:2.5em;\">\u003C/span>\u003Cspan class=\"sizing reset-size3 size1 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\">re\u003C/span>\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2901em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mopen mtight\">(\u003C/span>\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.1645em;\">\u003Cspan style=\"top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;\">\u003Cspan class=\"pstrut\" style=\"height:2.5em;\">\u003C/span>\u003Cspan class=\"sizing reset-size3 size1 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.02691em;\">w\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.143em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord mtight\">∣\u003C/span>\u003Cspan class=\"mord mathnormal mtight\">x\u003C/span>\u003Cspan class=\"mclose mtight\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.23em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"frac-line\" style=\"border-bottom-width:0.04em;\">\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.485em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">π\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3448em;\">\u003Cspan style=\"top:-2.3488em;margin-left:-0.0359em;margin-right:0.0714em;\">\u003Cspan class=\"pstrut\" style=\"height:2.5em;\">\u003C/span>\u003Cspan class=\"sizing reset-size3 size1 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">θ\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.1512em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mopen mtight\">(\u003C/span>\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.1645em;\">\u003Cspan style=\"top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;\">\u003Cspan class=\"pstrut\" style=\"height:2.5em;\">\u003C/span>\u003Cspan class=\"sizing reset-size3 size1 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.02691em;\">w\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.143em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord mtight\">∣\u003C/span>\u003Cspan class=\"mord mathnormal mtight\">x\u003C/span>\u003Cspan class=\"mclose mtight\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.5481em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose nulldelimiter\">\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003Cspan class=\"mbin\">−\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.2222em;\">\u003C/span>\u003C/span>\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:1.5581em;vertical-align:-0.5481em;\">\u003C/span>\u003Cspan class=\"mop\">lo\u003Cspan style=\"margin-right:0.01389em;\">g\u003C/span>\u003C/span>\u003Cspan class=\"mspace\" style=\"margin-right:0.1667em;\">\u003C/span>\u003Cspan class=\"mord\">\u003Cspan class=\"mopen nulldelimiter\">\u003C/span>\u003Cspan class=\"mfrac\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:1.01em;\">\u003Cspan style=\"top:-2.655em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">π\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3448em;\">\u003Cspan style=\"top:-2.3488em;margin-left:-0.0359em;margin-right:0.0714em;\">\u003Cspan class=\"pstrut\" style=\"height:2.5em;\">\u003C/span>\u003Cspan class=\"sizing reset-size3 size1 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\">re\u003C/span>\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.10764em;\">f\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.2901em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mopen mtight\">(\u003C/span>\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3448em;\">\u003Cspan style=\"top:-2.3488em;margin-left:-0.0359em;margin-right:0.0714em;\">\u003Cspan class=\"pstrut\" style=\"height:2.5em;\">\u003C/span>\u003Cspan class=\"sizing reset-size3 size1 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.1512em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord mtight\">∣\u003C/span>\u003Cspan class=\"mord mathnormal mtight\">x\u003C/span>\u003Cspan class=\"mclose mtight\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.23em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"frac-line\" style=\"border-bottom-width:0.04em;\">\u003C/span>\u003C/span>\u003Cspan style=\"top:-3.485em;\">\u003Cspan class=\"pstrut\" style=\"height:3em;\">\u003C/span>\u003Cspan class=\"sizing reset-size6 size3 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">π\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3448em;\">\u003Cspan style=\"top:-2.3488em;margin-left:-0.0359em;margin-right:0.0714em;\">\u003Cspan class=\"pstrut\" style=\"height:2.5em;\">\u003C/span>\u003Cspan class=\"sizing reset-size3 size1 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">θ\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.1512em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mopen mtight\">(\u003C/span>\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y\u003C/span>\u003Cspan class=\"msupsub\">\u003Cspan class=\"vlist-t vlist-t2\">\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.3448em;\">\u003Cspan style=\"top:-2.3488em;margin-left:-0.0359em;margin-right:0.0714em;\">\u003Cspan class=\"pstrut\" style=\"height:2.5em;\">\u003C/span>\u003Cspan class=\"sizing reset-size3 size1 mtight\">\u003Cspan class=\"mord mtight\">\u003Cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.1512em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mord mtight\">∣\u003C/span>\u003Cspan class=\"mord mathnormal mtight\">x\u003C/span>\u003Cspan class=\"mclose mtight\">)\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"vlist-s\">​\u003C/span>\u003C/span>\u003Cspan class=\"vlist-r\">\u003Cspan class=\"vlist\" style=\"height:0.5481em;\">\u003Cspan>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003Cspan class=\"mclose nulldelimiter\">\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/span>\u003C/p>\n\u003Cp>If this margin increases while \u003Cstrong>KL Divergence\u003C/strong> stays under \u003Cspan class=\"katex\">\u003Cspan class=\"katex-mathml\">\u003Cmath xmlns=\"http://www.w3.org/1998/Math/MathML\">\u003Csemantics>\u003Cmrow>\u003Cmn>0.2\u003C/mn>\u003C/mrow>\u003Cannotation encoding=\"application/x-tex\">0.2\u003C/annotation>\u003C/semantics>\u003C/math>\u003C/span>\u003Cspan class=\"katex-html\" aria-hidden=\"true\">\u003Cspan class=\"base\">\u003Cspan class=\"strut\" style=\"height:0.6444em;\">\u003C/span>\u003Cspan class=\"mord\">0.2\u003C/span>\u003C/span>\u003C/span>\u003C/span>, the model is successfully shifting its “vibe” without collapsing into repetitive or nonsensical text.\u003C/p>\n\u003Chr>\n\u003Ch2 id=\"7-the-see-more-proxy\">7. The “See More” Proxy\u003C/h2>\n\u003Cp>The most technical metric in this pipeline is the “See More” classifier. We use a BERT-based model trained on our scraped data to predict the \u003Cstrong>probability of a user clicking “See More”\u003C/strong> based purely on the text structure and the strength of the hook.\u003C/p>\n\u003Cp>By aligning our loss function with these behavioral proxies, we move beyond simple text generation and into the realm of \u003Cstrong>algorithmic engineering\u003C/strong>.\u003C/p>\n\u003Chr>\n\u003Ch2 id=\"8-conclusion\">8. Conclusion\u003C/h2>\n\u003Cp>Fine-tuning for style is significantly more difficult than fine-tuning for facts. It requires a clean gradient between “corporate noise” and “high-engagement prose.” By combining \u003Cstrong>QLoRA\u003C/strong> for efficiency and \u003Cstrong>DPO\u003C/strong> for alignment, we can create models that don’t just speak—they resonate.\u003C/p>\n\u003Cp>\u003Cstrong>What’s next?\u003C/strong> I am currently experimenting with \u003Cstrong>ORPO (Odds Ratio Preference Optimization)\u003C/strong> to see if we can achieve similar results in a single training step. Stay tuned for the benchmarks.\u003C/p>",{"headings":225,"localImagePaths":265,"remoteImagePaths":266,"frontmatter":267,"imagePaths":270},[226,229,232,235,238,241,244,247,250,253,256,259,262],{"depth":38,"slug":227,"text":228},"1-data-engineering-the-engagement-weighted-corpus","1. Data Engineering: The “Engagement-Weighted” Corpus",{"depth":54,"slug":230,"text":231},"the-pipeline","The Pipeline:",{"depth":38,"slug":233,"text":234},"2-modeling-qlora-with-high-rank-adapters","2. Modeling: QLoRA with High-Rank Adapters",{"depth":38,"slug":236,"text":237},"3-alignment-dpo-direct-preference-optimization","3. Alignment: DPO (Direct Preference Optimization)",{"depth":54,"slug":239,"text":240},"the-negative-sample-generator","The Negative Sample Generator",{"depth":38,"slug":242,"text":243},"4-implementation-pytorch--trl","4. Implementation (PyTorch + TRL)",{"depth":38,"slug":245,"text":246},"5-evaluation-beyond-perplexity","5. Evaluation: Beyond Perplexity",{"depth":54,"slug":248,"text":249},"a-llm-as-a-judge-the-rubric","A. LLM-as-a-Judge (The Rubric)",{"depth":54,"slug":251,"text":252},"b-embedding-drift-cosine-similarity","B. Embedding Drift (Cosine Similarity)",{"depth":54,"slug":254,"text":255},"c-structural-entropy","C. Structural Entropy",{"depth":38,"slug":257,"text":258},"6-advanced-monitoring-reward-margin","6. Advanced Monitoring: Reward Margin",{"depth":38,"slug":260,"text":261},"7-the-see-more-proxy","7. The “See More” Proxy",{"depth":38,"slug":263,"text":264},"8-conclusion","8. Conclusion",[217,218,219,220],[],{"title":207,"description":208,"pubDate":268,"author":17,"tags":269,"featured":25},"2026-01-23",[166,211,212,213,19,23],[217,218,219,220],"fine-tune-llm.md","fastapi-backend",{"id":272,"data":274,"body":283,"filePath":284,"digest":285,"rendered":286,"legacyId":318},{"title":275,"description":276,"pubDate":277,"author":17,"tags":278,"featured":25},"Building Scalable Backend Systems with Python and FastAPI","A comprehensive guide to designing and implementing production-ready backend systems using Python, FastAPI, and modern cloud-native practices.",["Date","2024-03-15T00:00:00.000Z"],[279,280,281,282],"Python","FastAPI","Backend","Cloud","## Introduction\n\nBuilding scalable backend systems is both an art and a science. In this article, I will share my experience and best practices for creating production-ready APIs using Python and FastAPI.\n\n## Why FastAPI?\n\nFastAPI has become my go-to framework for building APIs in Python. Here is why:\n\n1. **High Performance**: FastAPI is one of the fastest Python frameworks available\n2. **Type Safety**: Built-in support for Pydantic models and type hints\n3. **Auto Documentation**: Automatic OpenAPI and Swagger UI generation\n4. **Developer Experience**: Excellent error messages and easy debugging\n\n## Basic Setup\n\n```python\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\nclass Item(BaseModel):\n    name: str\n    description: str | None = None\n    price: float\n    tax: float | None = None\n\n@app.post(\"/items/\")\nasync def create_item(item: Item):\n    return item\n```\n\n## Best Practices\n\n### 1. Project Structure\n\nOrganize your project with a clean structure:\n\n```\nproject/\n├── app/\n│   ├── __init__.py\n│   ├── main.py\n│   ├── routers/\n│   ├── models/\n│   ├── schemas/\n│   └── services/\n├── tests/\n└── requirements.txt\n```\n\n### 2. Environment Configuration\n\nUse environment variables for configuration:\n\n```python\nfrom pydantic_settings import BaseSettings\n\nclass Settings(BaseSettings):\n    database_url: str\n    secret_key: str\n    api_version: str = \"v1\"\n    \n    class Config:\n        env_file = \".env\"\n```\n\n### 3. Database Integration\n\nFor production systems, I recommend using async databases:\n\n```python\nfrom databases import Database\nfrom sqlalchemy import create_engine\n\ndatabase = Database(DATABASE_URL)\n```\n\n## Conclusion\n\nFastAPI provides an excellent foundation for building scalable, type-safe APIs. Combined with proper architecture patterns and cloud-native practices, you can build systems that scale to millions of users.","src/content/blog/fastapi-backend.md","4269fe7f991f1bc9",{"html":287,"metadata":288},"\u003Ch2 id=\"introduction\">Introduction\u003C/h2>\n\u003Cp>Building scalable backend systems is both an art and a science. In this article, I will share my experience and best practices for creating production-ready APIs using Python and FastAPI.\u003C/p>\n\u003Ch2 id=\"why-fastapi\">Why FastAPI?\u003C/h2>\n\u003Cp>FastAPI has become my go-to framework for building APIs in Python. Here is why:\u003C/p>\n\u003Col>\n\u003Cli>\u003Cstrong>High Performance\u003C/strong>: FastAPI is one of the fastest Python frameworks available\u003C/li>\n\u003Cli>\u003Cstrong>Type Safety\u003C/strong>: Built-in support for Pydantic models and type hints\u003C/li>\n\u003Cli>\u003Cstrong>Auto Documentation\u003C/strong>: Automatic OpenAPI and Swagger UI generation\u003C/li>\n\u003Cli>\u003Cstrong>Developer Experience\u003C/strong>: Excellent error messages and easy debugging\u003C/li>\n\u003C/ol>\n\u003Ch2 id=\"basic-setup\">Basic Setup\u003C/h2>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">from\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> fastapi \u003C/span>\u003Cspan style=\"color:#F97583\">import\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> FastAPI\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">from\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> pydantic \u003C/span>\u003Cspan style=\"color:#F97583\">import\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> BaseModel\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">app \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> FastAPI()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">class\u003C/span>\u003Cspan style=\"color:#B392F0\"> Item\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#B392F0\">BaseModel\u003C/span>\u003Cspan style=\"color:#E1E4E8\">):\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    name: \u003C/span>\u003Cspan style=\"color:#79B8FF\">str\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    description: \u003C/span>\u003Cspan style=\"color:#79B8FF\">str\u003C/span>\u003Cspan style=\"color:#F97583\"> |\u003C/span>\u003Cspan style=\"color:#79B8FF\"> None\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#79B8FF\"> None\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    price: \u003C/span>\u003Cspan style=\"color:#79B8FF\">float\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    tax: \u003C/span>\u003Cspan style=\"color:#79B8FF\">float\u003C/span>\u003Cspan style=\"color:#F97583\"> |\u003C/span>\u003Cspan style=\"color:#79B8FF\"> None\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#79B8FF\"> None\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B392F0\">@app.post\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"/items/\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">async\u003C/span>\u003Cspan style=\"color:#F97583\"> def\u003C/span>\u003Cspan style=\"color:#B392F0\"> create_item\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(item: Item):\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    return\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> item\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"best-practices\">Best Practices\u003C/h2>\n\u003Ch3 id=\"1-project-structure\">1. Project Structure\u003C/h3>\n\u003Cp>Organize your project with a clean structure:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"plaintext\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan>project/\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>├── app/\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>│   ├── __init__.py\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>│   ├── main.py\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>│   ├── routers/\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>│   ├── models/\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>│   ├── schemas/\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>│   └── services/\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>├── tests/\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>└── requirements.txt\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"2-environment-configuration\">2. Environment Configuration\u003C/h3>\n\u003Cp>Use environment variables for configuration:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">from\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> pydantic_settings \u003C/span>\u003Cspan style=\"color:#F97583\">import\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> BaseSettings\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">class\u003C/span>\u003Cspan style=\"color:#B392F0\"> Settings\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#B392F0\">BaseSettings\u003C/span>\u003Cspan style=\"color:#E1E4E8\">):\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    database_url: \u003C/span>\u003Cspan style=\"color:#79B8FF\">str\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    secret_key: \u003C/span>\u003Cspan style=\"color:#79B8FF\">str\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    api_version: \u003C/span>\u003Cspan style=\"color:#79B8FF\">str\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"v1\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    class\u003C/span>\u003Cspan style=\"color:#B392F0\"> Config\u003C/span>\u003Cspan style=\"color:#E1E4E8\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        env_file \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \".env\"\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"3-database-integration\">3. Database Integration\u003C/h3>\n\u003Cp>For production systems, I recommend using async databases:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"python\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">from\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> databases \u003C/span>\u003Cspan style=\"color:#F97583\">import\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> Database\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">from\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> sqlalchemy \u003C/span>\u003Cspan style=\"color:#F97583\">import\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> create_engine\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">database \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> Database(\u003C/span>\u003Cspan style=\"color:#79B8FF\">DATABASE_URL\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"conclusion\">Conclusion\u003C/h2>\n\u003Cp>FastAPI provides an excellent foundation for building scalable, type-safe APIs. Combined with proper architecture patterns and cloud-native practices, you can build systems that scale to millions of users.\u003C/p>",{"headings":289,"localImagePaths":312,"remoteImagePaths":313,"frontmatter":314,"imagePaths":317},[290,293,296,299,302,305,308,311],{"depth":38,"slug":291,"text":292},"introduction","Introduction",{"depth":38,"slug":294,"text":295},"why-fastapi","Why FastAPI?",{"depth":38,"slug":297,"text":298},"basic-setup","Basic Setup",{"depth":38,"slug":300,"text":301},"best-practices","Best Practices",{"depth":54,"slug":303,"text":304},"1-project-structure","1. Project Structure",{"depth":54,"slug":306,"text":307},"2-environment-configuration","2. Environment Configuration",{"depth":54,"slug":309,"text":310},"3-database-integration","3. Database Integration",{"depth":38,"slug":195,"text":196},[],[],{"title":275,"description":276,"pubDate":315,"author":17,"tags":316,"featured":25},"2024-03-15",[279,280,281,282],[],"fastapi-backend.md"]